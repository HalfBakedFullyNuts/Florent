(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2844:function(e,t,r){Promise.resolve().then(r.bind(r,1169))},1169:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return et}});var n=r(7437),s=r(2265);let a=["metal","mineral","food","energy","research_points"],i=["building","ship","colonist","research"],o={stocks:{metal:3e4,mineral:2e4,food:1e3,energy:0,research_points:0},abundance:{metal:1,mineral:1,food:1,energy:1,research_points:1},population:{workersTotal:2e4,workersIdle:2e4,soldiers:0,scientists:0},space:{groundUsed:8,groundCap:60,orbitalUsed:0,orbitalCap:40}},l=["leisure_centre","hospital"];function u(e){let t={metal:0,mineral:0,food:0,energy:0,research_points:0};for(let[r,n]of Object.entries(e.completedCounts)){if(0===n)continue;let s=e.defs[r];if(!s)continue;let i=s.effectsOnComplete;if(i)for(let r of a){let a=i["production_".concat(r)]||0;if(a>0){let i=s.isAbundanceScaled?a*e.abundance[r]:a;t[r]+=i*n}}let o=s.upkeepPerUnit;if(o)for(let e of a){let r=o[e]||0;t[e]-=r*n}}let r=c(e);return t.food-=r,t.research_points+=e.population.scientists,t}function c(e){let{workersTotal:t,soldiers:r,scientists:n}=e.population;return(t+r+n)*.002}function d(e,t,r){return!function(e,t){if(!t.prerequisites||0===t.prerequisites.length)return!0;for(let n of t.prerequisites){if(e.completedResearch&&e.completedResearch.includes(n)||(e.completedCounts[n]||0)>0)continue;let t=[e.lanes.building,e.lanes.ship,e.lanes.colonist,e.lanes.research],s=!1;for(let e of t){var r;if((null===(r=e.active)||void 0===r?void 0:r.itemId)===n||e.pendingQueue.some(e=>e.itemId===n)){s=!0;break}}if(!s)return!1}return!0}(e,t)?{allowed:!1,reason:"REQ_MISSING"}:!function(e,t){var r;let n;if(null===t.maxPerPlanet||void 0===t.maxPerPlanet||"building"!==t.lane)return!1;for(let s of(n=0+(e.completedCounts[t.id]||0),(null===(r=e.lanes.building.active)||void 0===r?void 0:r.itemId)===t.id&&(n+=e.lanes.building.active.quantity),e.lanes.building.pendingQueue))s.itemId===t.id&&(n+=s.quantity);return n>=t.maxPerPlanet}(e,t)?t.colonistKind&&t.colonistKind&&("soldier"===t.colonistKind?!(e.housing.soldierCap-e.population.soldiers>=r):"scientist"===t.colonistKind&&!(e.housing.scientistCap-e.population.scientists>=r))?{allowed:!1,reason:"HOUSING_MISSING"}:!function(e,t,r){var n;let s=(null===(n=t.upkeepPerUnit)||void 0===n?void 0:n.energy)||0;return 0===s||u(e).energy-s*r>=0}(e,t,r)?{allowed:!1,reason:"ENERGY_INSUFFICIENT"}:{allowed:!0}:{allowed:!1,reason:"PLANET_LIMIT_REACHED"}}function p(e){return JSON.parse(JSON.stringify(e))}function m(){return"wi_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9))}class h{setEnabled(e){this.config.enabled=e}isEnabled(){return this.config.enabled}logQueueOperation(e,t,r,n,s,a,i){this.config.enabled&&(this.queueOps.push({timestamp:new Date().toISOString(),turn:e,operation:t,laneId:r,itemId:n,itemName:s,quantity:a,details:i}),this.incrementAndFlush())}logStateSnapshot(e){var t,r,n,s;this.config.enabled&&(this.stateSnapshots.push({timestamp:new Date().toISOString(),turn:e.currentTurn,metal:Math.round(e.stocks.metal),mineral:Math.round(e.stocks.mineral),food:Math.round(e.stocks.food),energy:Math.round(e.stocks.energy),research_points:Math.round(e.stocks.research_points),workersTotal:e.population.workersTotal,workersIdle:e.population.workersIdle,soldiers:e.population.soldiers,scientists:e.population.scientists,buildingActive:(null===(t=e.lanes.building.active)||void 0===t?void 0:t.itemId)||"",buildingPending:e.lanes.building.pendingQueue.length,shipActive:(null===(r=e.lanes.ship.active)||void 0===r?void 0:r.itemId)||"",shipPending:e.lanes.ship.pendingQueue.length,colonistActive:(null===(n=e.lanes.colonist.active)||void 0===n?void 0:n.itemId)||"",colonistPending:e.lanes.colonist.pendingQueue.length,researchActive:(null===(s=e.lanes.research.active)||void 0===s?void 0:s.itemId)||"",researchPending:e.lanes.research.pendingQueue.length}),this.incrementAndFlush())}logTimelineEvent(e,t,r,n){this.config.enabled&&(this.timelineEvents.push({timestamp:new Date().toISOString(),turn:e,event:t,description:r,affectedTurns:n}),this.incrementAndFlush())}incrementAndFlush(){this.opCount++,this.opCount>=this.flushInterval&&this.flush()}async flush(){if(this.config.enabled)try{this.queueOps.length>0&&(await this.writeQueueOperations(),this.queueOps=[]),this.stateSnapshots.length>0&&(await this.writeStateSnapshots(),this.stateSnapshots=[]),this.timelineEvents.length>0&&(await this.writeTimelineEvents(),this.timelineEvents=[]),this.opCount=0}catch(e){console.error("[Logger] Failed to flush logs:",e)}}async writeQueueOperations(){let e=this.queueOpsToCSV(this.queueOps);await this.appendToFile("queue_operations.csv",e)}async writeStateSnapshots(){let e=this.stateSnapshotsToCSV(this.stateSnapshots);await this.appendToFile("planet_states.csv",e)}async writeTimelineEvents(){let e=this.timelineEventsToCSV(this.timelineEvents);await this.appendToFile("timeline_events.csv",e)}queueOpsToCSV(e){return e.map(e=>"".concat(e.timestamp,",").concat(e.turn,",").concat(e.operation,",").concat(e.laneId,",").concat(e.itemId,",").concat(e.itemName,",").concat(e.quantity||"",",").concat(e.details||"")).join("\n")}stateSnapshotsToCSV(e){return e.map(e=>"".concat(e.timestamp,",").concat(e.turn,",").concat(e.metal,",").concat(e.mineral,",").concat(e.food,",").concat(e.energy,",").concat(e.research_points,",").concat(e.workersTotal,",").concat(e.workersIdle,",").concat(e.soldiers,",").concat(e.scientists,",").concat(e.buildingActive,",").concat(e.buildingPending,",").concat(e.shipActive,",").concat(e.shipPending,",").concat(e.colonistActive,",").concat(e.colonistPending,",").concat(e.researchActive,",").concat(e.researchPending)).join("\n")}timelineEventsToCSV(e){return e.map(e=>"".concat(e.timestamp,",").concat(e.turn,",").concat(e.event,",").concat(e.description,",").concat(e.affectedTurns||"")).join("\n")}async appendToFile(e,t){if("undefined"!=typeof document)try{let r="".concat(this.config.sessionId,"_").concat(e),n=localStorage.getItem(r)||"";localStorage.setItem(r,n+t+"\n")}catch(e){console.warn("[Logger] Failed to write to localStorage:",e)}}async initialize(){if(this.config.enabled)try{await this.appendToFile("queue_operations.csv","timestamp,turn,operation,laneId,itemId,itemName,quantity,details"),await this.appendToFile("planet_states.csv","timestamp,turn,metal,mineral,food,energy,research_points,workersTotal,workersIdle,soldiers,scientists,buildingActive,buildingPending,shipActive,shipPending,colonistActive,colonistPending,researchActive,researchPending"),await this.appendToFile("timeline_events.csv","timestamp,turn,event,description,affectedTurns")}catch(e){console.error("[Logger] Failed to initialize log files:",e)}}exportLogsFromBrowser(){let e=[],t="".concat(this.config.sessionId,"_");for(let r=0;r<localStorage.length;r++){let n=localStorage.key(r);if(n&&n.startsWith(t)){let r=n.replace(t,""),s=localStorage.getItem(n)||"";e.push({filename:r,content:s})}}return e}clearLogsFromBrowser(){let e="".concat(this.config.sessionId,"_"),t=[];for(let r=0;r<localStorage.length;r++){let n=localStorage.key(r);n&&n.startsWith(e)&&t.push(n)}t.forEach(e=>localStorage.removeItem(e))}constructor(e){this.queueOps=[],this.stateSnapshots=[],this.timelineEvents=[],this.flushInterval=50,this.opCount=0,this.config=e}}let b=null;function _(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(b=new h({enabled:e,sessionId:"session_".concat(Date.now()),logDir:"logs"})).initialize(),b}function g(){return b||_(!1)}function y(e,t){for(let r of t)!function(e,t){let r=e.defs[t.itemId];if(!r){console.error("Definition not found for item: ".concat(t.itemId));return}"research"===r.lane?(e.completedResearch||(e.completedResearch=[]),e.completedResearch.includes(t.itemId)||e.completedResearch.push(t.itemId)):e.completedCounts[t.itemId]=(e.completedCounts[t.itemId]||0)+t.quantity;let n=r.effectsOnComplete;n&&(n.housing_worker_cap&&(e.housing.workerCap+=n.housing_worker_cap*t.quantity),n.housing_soldier_cap&&(e.housing.soldierCap+=n.housing_soldier_cap*t.quantity),n.housing_scientist_cap&&(e.housing.scientistCap+=n.housing_scientist_cap*t.quantity),n.space_ground_cap&&(e.space.groundCap+=n.space_ground_cap*t.quantity),n.space_orbital_cap&&(e.space.orbitalCap+=n.space_orbital_cap*t.quantity),n.planet_limit&&void 0!==e.planetLimit&&(e.planetLimit=n.planet_limit))}(e,r)}function f(e){let t=0;for(let r of l)t+=e.completedCounts[r]||0;return .005*t}class x{enqueue(e,t){let r=this.completions.get(e)||[];r.push(t),this.completions.set(e,r)}drain(e){let t=this.completions.get(e)||[];return this.completions.delete(e),t}clear(){this.completions.clear()}constructor(){this.completions=new Map}}class v{getStateAtTurn(e){var t;let r=e-((null===(t=this.states[0])||void 0===t?void 0:t.currentTurn)||1);if(!(r<0)&&!(r>=this.states.length)){if(this.stableFromTurn>=0&&r>this.stableFromTurn){if(!this.states[r]){let e=this.states[this.stableFromTurn];this.states[r]=p(e),this.states[r].currentTurn=e.currentTurn+(r-this.stableFromTurn)}return p(this.states[r])}if(r>this.highestComputedIndex){let e=Math.min(r+v.LAZY_COMPUTE_BUFFER,v.FIXED_TURNS-1);if(this.computeUpToIndex(e),!this.states[r]&&this.stableFromTurn>=0&&r>this.stableFromTurn){let e=this.states[this.stableFromTurn];this.states[r]=p(e),this.states[r].currentTurn=e.currentTurn+(r-this.stableFromTurn)}}if(this.states[r])return p(this.states[r])}}getCurrentTurn(){var e;return this.ensureComputedUpTo(this.currentTurnIndex),(null===(e=this.states[this.currentTurnIndex])||void 0===e?void 0:e.currentTurn)||1}getCurrentState(){if(this.currentTurnIndex>this.highestComputedIndex){let e=Math.min(this.currentTurnIndex+v.LAZY_COMPUTE_BUFFER,v.FIXED_TURNS-1);this.computeUpToIndex(e)}return p(this.states[this.currentTurnIndex])}getTotalTurns(){return v.FIXED_TURNS}ensureComputedUpTo(e){if(e>this.highestComputedIndex){let t=Math.min(e+v.LAZY_COMPUTE_BUFFER,v.FIXED_TURNS-1);this.computeUpToIndex(t)}}computeUpToIndex(e){if(e<=this.highestComputedIndex)return;let t=performance.now(),r=this.highestComputedIndex+1,n=this.highestComputedIndex;for(let t=r;t<=e;t++)if(this.states[t]=p(this.states[t-1]),!function(e,t){let r=e.currentTurn;y(e,t.drain(r));let n=[];for(let s of i){!function(e,t){let r=e.lanes[t];if(0===r.pendingQueue.length||r.active)return;let n=r.pendingQueue[0];if(n.isWait){r.active={...n,status:"active",startTurn:e.currentTurn},g().logQueueOperation(e.currentTurn,"activate",t,"__wait__","Wait",n.quantity,"Wait activated for ".concat(n.turnsRemaining," turns")),r.pendingQueue.shift();return}let s=e.defs[n.itemId];if(!s){console.error("Definition not found for item: ".concat(n.itemId));return}let a=function(e,t,r){let n=r,s=t.costsPerUnit;s.metal>0&&(n=Math.min(n,Math.floor(e.stocks.metal/s.metal))),s.mineral>0&&(n=Math.min(n,Math.floor(e.stocks.mineral/s.mineral))),s.food>0&&(n=Math.min(n,Math.floor(e.stocks.food/s.food))),s.energy>0&&(n=Math.min(n,Math.floor(e.stocks.energy/s.energy)));let a=t.costsPerUnit.workers||0;a>0&&(n=Math.min(n,Math.floor(e.population.workersIdle/a)));let i=t.costsPerUnit.space||0;return i>0&&(n=Math.min(n,Math.floor(("ground"==("structure"===t.type?"ground":"orbital")?e.space.groundCap-e.space.groundUsed:e.space.orbitalCap-e.space.orbitalUsed)/i))),Math.max(0,n)}(e,s,n.quantity);if(0===a)return;let i=s.costsPerUnit;e.stocks.metal-=i.metal*a,e.stocks.mineral-=i.mineral*a,e.stocks.food-=i.food*a,e.stocks.energy-=i.energy*a,"research"!==t&&(e.stocks.research_points-=i.research_points*a);let o=i.workers||0;if(o>0){let r=o*a;e.population.workersIdle-=r,e.population.busyByLane[t]=(e.population.busyByLane[t]||0)+r}let l=i.space||0;if(l>0){let t=l*a;"structure"===s.type?e.space.groundUsed+=t:e.space.orbitalUsed+=t}r.active={...n,quantity:a,status:"active",turnsRemaining:s.durationTurns,startTurn:e.currentTurn},g().logQueueOperation(e.currentTurn,"activate",t,s.id,s.name,a,"Activated with ".concat(a," quantity (requested: ").concat(n.quantity,")")),r.pendingQueue.shift()}(e,s);let a=function(e,t){let r=e.lanes[t];if(!r.active)return null;let n=r.active;if(n.turnsRemaining-=1,n.turnsRemaining<=0){if(n.isWait){n.status="completed",n.completionTurn=e.currentTurn;let s={...n};return g().logQueueOperation(e.currentTurn,"complete",t,"__wait__","Wait",n.quantity,"Wait completed at turn ".concat(e.currentTurn)),r.completionHistory.push(s),r.active=null,s}let s=e.defs[n.itemId];if(!s)return console.error("Definition not found for item: ".concat(n.itemId)),null;let a=s.costsPerUnit.workers||0;if(a>0){let r=a*n.quantity;e.population.busyByLane[t]=(e.population.busyByLane[t]||0)-r,s.colonistKind||(e.population.workersIdle+=r)}n.status="completed",n.completionTurn=e.currentTurn;let i={...n};return g().logQueueOperation(e.currentTurn,"complete",t,s.id,s.name,n.quantity,"Completed at turn ".concat(e.currentTurn)),r.completionHistory.push(i),r.active=null,s.colonistKind&&e.pendingColonistConversions.push(i),i}return null}(e,s);if(a){let s=e.defs[a.itemId];s&&!s.colonistKind&&("structure"===s.type?n.push(a):t.enqueue(r+1,a))}}y(e,n),function(e){for(let t of e.pendingColonistConversions)!function(e,t){let r=e.defs[t.itemId];if(!r){console.error("Definition not found for item: ".concat(t.itemId));return}if(!r.colonistKind){console.error("Item is not a colonist: ".concat(t.itemId));return}let n=(r.costsPerUnit.workers||0)*t.quantity-t.quantity,s=t.quantity;e.population.workersIdle+=n,e.population.workersTotal-=s,"soldier"===r.colonistKind?e.population.soldiers+=s:"scientist"===r.colonistKind&&(e.population.scientists+=s),e.completedCounts[t.itemId]=(e.completedCounts[t.itemId]||0)+t.quantity}(e,t);e.pendingColonistConversions=[]}(e);let s=u(e);for(let t of(e.stocks.metal+=s.metal,e.stocks.mineral+=s.mineral,e.stocks.food+=s.food,e.stocks.energy+=s.energy,e.stocks.research_points+=s.research_points,a))e.stocks[t]=Math.max(0,e.stocks[t]);(function(e){if(e.stocks.food<=0)return;let t=.01+f(e),r=Math.max(0,Math.min(Math.floor(e.population.workersTotal*t),e.housing.workerCap-e.population.workersTotal));e.population.workersTotal+=r,e.population.workersIdle+=r})(e),e.currentTurn+=1}(this.states[t],this.completionBuffer),n=t,-1===this.stableFromTurn&&this.isStableState(this.states[t])){this.stableFromTurn=t,g().logTimelineEvent(this.states[t].currentTurn,"stable_state","Stable state detected at turn ".concat(this.states[t].currentTurn));break}this.highestComputedIndex=n;let s=performance.now()-t;if(s>100){var o;g().logTimelineEvent((null===(o=this.states[this.highestComputedIndex])||void 0===o?void 0:o.currentTurn)||0,"recompute","Computed turns ".concat(r,"-").concat(this.highestComputedIndex," in ").concat(s.toFixed(1),"ms").concat(this.stableFromTurn>=0?", stable from T".concat(this.stableFromTurn):""))}}recomputeAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.stableFromTurn=-1,1===e?(this.completionBuffer.clear(),this.highestComputedIndex=0):this.highestComputedIndex=Math.max(0,e-1);let t=Math.max(this.highestComputedIndex+v.LAZY_COMPUTE_BUFFER,v.LAZY_COMPUTE_BUFFER);this.computeUpToIndex(Math.min(t,v.FIXED_TURNS-1))}isStableState(e){return!!Object.values(e.lanes).every(e=>!e.active&&0===e.pendingQueue.length)&&!(e.population.scientists>0)}setCurrentTurn(e){var t;let r=e-((null===(t=this.states[0])||void 0===t?void 0:t.currentTurn)||1);return!(r<0)&&!(r>=this.states.length)&&(this.ensureComputedUpTo(r),this.currentTurnIndex=r,!0)}nextTurn(){return this.currentTurnIndex<v.FIXED_TURNS-1&&(this.currentTurnIndex+=1,g().logTimelineEvent(this.getCurrentTurn(),"advance","Advanced to turn ".concat(this.getCurrentTurn()))),this.getCurrentState()}simulateTurns(e){let t=Math.min(this.currentTurnIndex+e,v.FIXED_TURNS-1);this.ensureComputedUpTo(t),this.currentTurnIndex=t}mutateAtTurn(e,t){var r;let n=e-((null===(r=this.states[0])||void 0===r?void 0:r.currentTurn)||1);if(n<0||n>=v.FIXED_TURNS)return!1;if(this.ensureComputedUpTo(n),!this.states[n]&&this.stableFromTurn>=0&&n>this.stableFromTurn){let e=this.states[this.stableFromTurn];this.states[n]=p(e),this.states[n].currentTurn=e.currentTurn+(n-this.stableFromTurn)}return t(this.states[n]),g().logTimelineEvent(e,"mutation","State mutated at turn ".concat(e),v.FIXED_TURNS-e),n+1<v.FIXED_TURNS&&this.recomputeAll(n+1),!0}reset(e){this.states=Array(v.FIXED_TURNS),this.states[0]=p(e),this.currentTurnIndex=0,this.completionBuffer.clear(),this.recomputeAll()}getAllStates(){if(this.ensureComputedUpTo(v.FIXED_TURNS-1),this.stableFromTurn>=0){let e=this.states[this.stableFromTurn];for(let t=this.stableFromTurn+1;t<v.FIXED_TURNS;t++)this.states[t]||(this.states[t]=p(e),this.states[t].currentTurn=e.currentTurn+(t-this.stableFromTurn))}return this.states.map(e=>p(e))}constructor(e){this.stableFromTurn=-1,this.highestComputedIndex=0,this.states=Array(v.FIXED_TURNS),this.states[0]=p(e),this.currentTurnIndex=0,this.completionBuffer=new x,this.highestComputedIndex=0}}v.FIXED_TURNS=200,v.LAZY_COMPUTE_BUFFER=50;class k{queueItem(e,t,r){let n=this.timeline.getStateAtTurn(e);if(!n)return{success:!1,reason:"INVALID_LANE"};let s=n.defs[t];if(!s)return{success:!1,reason:"INVALID_LANE"};let a=s.lane,i=n.lanes[a];if(i.active||i.pendingQueue.length>=i.maxQueueDepth)return{success:!1,reason:"INVALID_LANE"};let o=d(n,s,r);if(!o.allowed)return{success:!1,reason:o.reason};let l=m(),u={id:l,itemId:t,quantity:r,status:"pending",turnsRemaining:s.durationTurns,queuedTurn:e};return this.timeline.mutateAtTurn(e,e=>{if(e.lanes[a].pendingQueue.push(u),"research"===a){let t=s.costsPerUnit.research_points||0;e.stocks.research_points-=t*r}})?(g().logQueueOperation(e,"queue",a,t,s.name,r,"Queued at turn ".concat(e)),{success:!0,itemId:l}):{success:!1,reason:"INVALID_LANE"}}queueWaitItem(e,t,r){let n=this.timeline.getStateAtTurn(e);if(!n)return{success:!1,reason:"INVALID_LANE"};let s=n.lanes[t];if(s.active||s.pendingQueue.length>=s.maxQueueDepth||r<=0)return{success:!1,reason:"INVALID_LANE"};let a=m(),i={id:a,itemId:"__wait__",quantity:1,status:"pending",turnsRemaining:r,queuedTurn:e,isWait:!0};return this.timeline.mutateAtTurn(e,e=>{e.lanes[t].pendingQueue.push(i)})?(g().logQueueOperation(e,"queue",t,"__wait__","Wait",1,"Queued wait for ".concat(r," turns at turn ").concat(e)),{success:!0,itemId:a}):{success:!1,reason:"INVALID_LANE"}}cancelEntry(e,t){var r,n,s;let a=this.timeline.getStateAtTurn(e);if(!a)return{success:!1,reason:"INVALID_TURN"};let i=a.lanes[t];if(i.pendingQueue.length>0){this.timeline.mutateAtTurn(e,e=>{let r=e.lanes[t].pendingQueue[0];if(r&&"research"===t){let t=e.defs[r.itemId];if(t){let n=t.costsPerUnit.research_points||0;e.stocks.research_points+=n*r.quantity}}e.lanes[t].pendingQueue.shift()});let n=a.defs[null===(r=i.pendingQueue[0])||void 0===r?void 0:r.itemId];return n&&g().logQueueOperation(e,"cancel",t,n.id,n.name,void 0,"Cancelled pending item"),{success:!0}}if(i.active){this.timeline.mutateAtTurn(e,e=>{let r=e.lanes[t].active;if(!r)return;if(r.isWait){e.lanes[t].active=null;return}let n=e.defs[r.itemId];if(!n)return;let s=n.costsPerUnit;e.stocks.metal+=s.metal*r.quantity,e.stocks.mineral+=s.mineral*r.quantity,e.stocks.food+=s.food*r.quantity,e.stocks.energy+=s.energy*r.quantity,e.stocks.research_points+=s.research_points*r.quantity;let a=s.workers||0;if(a>0){let n=a*r.quantity;e.population.workersIdle+=n,e.population.busyByLane[t]=(e.population.busyByLane[t]||0)-n}let i=s.space||0;if(i>0){let t=i*r.quantity;"structure"===n.type?e.space.groundUsed-=t:e.space.orbitalUsed-=t}e.lanes[t].active=null});let r=a.defs[(null===(n=i.active)||void 0===n?void 0:n.itemId)||""];return r&&g().logQueueOperation(e,"cancel",t,r.id,r.name,null===(s=i.active)||void 0===s?void 0:s.quantity,"Cancelled active item"),{success:!0}}return{success:!1,reason:"NOT_FOUND"}}cancelEntryById(e,t,r){let n=this.timeline.getStateAtTurn(e);if(!n)return{success:!1,reason:"INVALID_TURN"};let s=n.lanes[t],a=s.pendingQueue.findIndex(e=>e.id===r);return -1!==a?(this.timeline.mutateAtTurn(e,e=>{let r=e.lanes[t].pendingQueue[a];if(r&&"research"===t){let t=e.defs[r.itemId];if(t){let n=t.costsPerUnit.research_points||0;e.stocks.research_points+=n*r.quantity}}e.lanes[t].pendingQueue.splice(a,1)}),{success:!0}):s.active&&s.active.id===r?(this.timeline.mutateAtTurn(e,e=>{let r=e.lanes[t].active;if(!r)return;if(r.isWait){e.lanes[t].active=null;return}let n=e.defs[r.itemId];if(!n)return;let s=n.costsPerUnit;e.stocks.metal+=s.metal*r.quantity,e.stocks.mineral+=s.mineral*r.quantity,e.stocks.food+=s.food*r.quantity,e.stocks.energy+=s.energy*r.quantity,e.stocks.research_points+=s.research_points*r.quantity;let a=s.workers||0;if(a>0){let n=a*r.quantity;e.population.workersIdle+=n,e.population.busyByLane[t]=(e.population.busyByLane[t]||0)-n}let i=s.space||0;if(i>0){let t=i*r.quantity;"structure"===n.type?e.space.groundUsed-=t:e.space.orbitalUsed-=t}e.lanes[t].active=null}),{success:!0}):{success:!1,reason:"NOT_FOUND"}}cancelEntryByIdSmart(e,t,r){var n,s;let a=this.getTotalTurns(),i=this.timeline.getStateAtTurn(e);if(i){let s=i.lanes[t],a=s.pendingQueue.some(e=>e.id===r),o=(null===(n=s.active)||void 0===n?void 0:n.id)===r;if(a||o)return this.cancelEntryById(e,t,r)}for(let n=e+1;n<a;n++){let e=this.timeline.getStateAtTurn(n);if(!e)continue;let a=e.lanes[t],i=a.pendingQueue.some(e=>e.id===r),o=(null===(s=a.active)||void 0===s?void 0:s.id)===r;if(i||o)return this.cancelEntryById(n,t,r);if(a.completionHistory.some(e=>e.id===r))break}return{success:!1,reason:"NOT_FOUND"}}removeFromHistory(e,t,r){return console.warn("[removeFromHistory] This operation is deprecated and causes state corruption."),console.warn("You cannot retroactively remove completed items from history."),console.warn("Only pending/active items can be canceled before completion."),{success:!1,reason:"NOT_FOUND"}}nextTurn(){return this.timeline.nextTurn()}setTurn(e){return this.timeline.setCurrentTurn(e)}simulateTurns(e){this.timeline.simulateTurns(e)}loadScenario(e){this.timeline.reset(e)}getCurrentState(){return this.timeline.getCurrentState()}reorderQueueItem(e,t,r,n){let s=this.timeline.getStateAtTurn(e);if(!s)return{success:!1,reason:"INVALID_TURN"};let a=s.lanes[t];if(!a)return{success:!1,reason:"INVALID_LANE"};let i=a.pendingQueue.findIndex(e=>e.id===r);if(-1===i)return{success:!1,reason:"NOT_FOUND"};let o=a.pendingQueue.length-1;if(n<0||n>o)return{success:!1,reason:"INVALID_INDEX"};this.timeline.mutateAtTurn(e,e=>{let r=e.lanes[t],[s]=r.pendingQueue.splice(i,1);r.pendingQueue.splice(n,0,s)});let l=a.pendingQueue[n];if(l){let r=s.defs[l.itemId];r&&g().logQueueOperation(e,"reorder",t,r.id,r.name,void 0,"Moved from index ".concat(i," to ").concat(n))}return{success:!0}}getStateAtTurn(e){return this.timeline.getStateAtTurn(e)}getCurrentTurn(){return this.timeline.getCurrentTurn()}getTotalTurns(){return this.timeline.getTotalTurns()}getAllStates(){return this.timeline.getAllStates()}constructor(e,t){this.timeline=t||new v(e)}}function w(e){var t,r,n,s,a,i,l,u,c,d,p,m,h,b,_,g,y,f,x,v,k,w,N,T,I,j;let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q={metal:null!==(b=null===(t=C.stocks)||void 0===t?void 0:t.metal)&&void 0!==b?b:o.stocks.metal,mineral:null!==(_=null===(r=C.stocks)||void 0===r?void 0:r.mineral)&&void 0!==_?_:o.stocks.mineral,food:null!==(g=null===(n=C.stocks)||void 0===n?void 0:n.food)&&void 0!==g?g:o.stocks.food,energy:null!==(y=null===(s=C.stocks)||void 0===s?void 0:s.energy)&&void 0!==y?y:o.stocks.energy,research_points:0},S={metal:null!==(f=null===(a=C.abundance)||void 0===a?void 0:a.metal)&&void 0!==f?f:o.abundance.metal,mineral:null!==(x=null===(i=C.abundance)||void 0===i?void 0:i.mineral)&&void 0!==x?x:o.abundance.mineral,food:null!==(v=null===(l=C.abundance)||void 0===l?void 0:l.food)&&void 0!==v?v:o.abundance.food,energy:null!==(k=null===(u=C.abundance)||void 0===u?void 0:u.energy)&&void 0!==k?k:o.abundance.energy,research_points:1},E=null!==(w=null===(c=C.population)||void 0===c?void 0:c.workersTotal)&&void 0!==w?w:o.population.workersTotal,U=null!==(N=null===(d=C.population)||void 0===d?void 0:d.soldiers)&&void 0!==N?N:o.population.soldiers,R=null!==(T=null===(p=C.population)||void 0===p?void 0:p.scientists)&&void 0!==T?T:o.population.scientists,O=C.structures||{outpost:1,metal_mine:3,mineral_extractor:3,farm:1,solar_generator:1},L={},M=0,D=0,P=0,A=null!==(I=null===(m=C.space)||void 0===m?void 0:m.groundCap)&&void 0!==I?I:o.space.groundCap,F=null!==(j=null===(h=C.space)||void 0===h?void 0:h.orbitalCap)&&void 0!==j?j:o.space.orbitalCap,Q=0;for(let[t,r]of Object.entries(O)){let n=e[t];if(!n){console.warn("Starting structure not found in definitions: ".concat(t));continue}L[t]=r,Q+=(n.costsPerUnit.space||0)*r;let s=n.effectsOnComplete;s&&(M+=(s.housing_worker_cap||0)*r,D+=(s.housing_soldier_cap||0)*r,P+=(s.housing_scientist_cap||0)*r,A+=(s.space_ground_cap||0)*r,F+=(s.space_orbital_cap||0)*r)}return{currentTurn:1,stocks:q,abundance:S,population:{workersTotal:E,workersIdle:E,soldiers:U,scientists:R,busyByLane:{building:0,ship:0,colonist:0,research:0}},space:{groundUsed:Q,groundCap:A,orbitalUsed:0,orbitalCap:F},housing:{workerCap:M,soldierCap:D,scientistCap:P},planetLimit:4,completedResearch:[],lanes:{building:{pendingQueue:[],active:null,completionHistory:[],maxQueueDepth:75},ship:{pendingQueue:[],active:null,completionHistory:[],maxQueueDepth:75},colonist:{pendingQueue:[],active:null,completionHistory:[],maxQueueDepth:75},research:{pendingQueue:[],active:null,completionHistory:[],maxQueueDepth:1}},completedCounts:L,pendingColonistConversions:[],defs:e}}function N(e){let t={};for(let r of e.units){let e=function(e){let t,r,n;"colonist"===e.category?(t="colonist",r=n="soldier"===e.id?"soldier":"scientist"===e.id?"scientist":"soldier"):(t="ship",n="ship");let s={metal:0,mineral:0,food:0,energy:0,research_points:0,workers:e.build_requirements.workers_occupied||0,space:0};for(let t of e.cost)"resource"===t.type&&t.id in s&&(s[t.id]=t.amount);let a=e.requirements.map(e=>e.id);return{id:e.id,name:e.name,lane:t,type:n,tier:e.tier,durationTurns:e.build_time_turns,costsPerUnit:s,effectsOnComplete:{},upkeepPerUnit:{metal:0,mineral:0,food:0,energy:0,research_points:0},colonistKind:r,isAbundanceScaled:!1,prerequisites:a}}(r);t[e.id]=e}for(let r of e.structures){let e=function(e){var t,r,n;let s={metal:0,mineral:0,food:0,energy:0,research_points:0,workers:e.build_requirements.workers_occupied||0,space:0};for(let t of e.cost)"resource"===t.type&&t.id in s&&(s[t.id]=t.amount);if(e.build_requirements.space_cost)for(let t of e.build_requirements.space_cost)"ground_space"===t.type?s.space=t.amount:"orbital_space"===t.type&&(s.space=t.amount);let a={};if(null===(t=e.operations)||void 0===t?void 0:t.effects){for(let t of e.operations.effects)if("PROVIDE_HOUSING"===t.type)"worker"===t.category?a.housing_worker_cap=t.amount||0:"soldier"===t.category?a.housing_soldier_cap=t.amount||0:"scientist"===t.category&&(a.housing_scientist_cap=t.amount||0);else if("PROVIDE_SPACE"===t.type){let e=t.space_type;"ground"===e?a.space_ground_cap=t.amount||0:"orbital"===e&&(a.space_orbital_cap=t.amount||0)}}let i=!1;if(null===(r=e.operations)||void 0===r?void 0:r.production)for(let t of e.operations.production)a["production_".concat(t.type)]=t.base_amount,t.is_abundance_scaled&&(i=!0);let o={metal:0,mineral:0,food:0,energy:0,research_points:0};if(null===(n=e.operations)||void 0===n?void 0:n.consumption)for(let t of e.operations.consumption)"resource"===t.type&&t.id&&t.id in o&&(o[t.id]=t.amount||0);let l=e.requirements.map(e=>e.id);return{id:e.id,name:e.name,lane:"building",type:"structure",tier:e.tier,durationTurns:e.build_time_turns,costsPerUnit:s,effectsOnComplete:a,upkeepPerUnit:o,isAbundanceScaled:i,prerequisites:l,maxPerPlanet:e.max_per_planet}}(r);t[e.id]=e}if(e.research)for(let r of e.research){let e=function(e){let t={metal:0,mineral:0,food:0,energy:0,research_points:0,workers:0,space:0};for(let r of e.cost)"resource"===r.type&&"research_points"===r.id&&(t.research_points=r.amount);let r={};if(e.operations)for(let t of e.operations)"on_complete"===t.type&&("set_planet_limit"===t.effect?r.planet_limit=t.value:"unlock_research"===t.effect?r.unlocks_research=t.items:"unlock_structure"===t.effect?r.unlocks_structure=t.item:"unlock_unit"===t.effect&&(r.unlocks_unit=t.item));let n=e.requirements||[];return{id:e.id,name:e.name,lane:"research",type:"structure",tier:e.tier,durationTurns:e.build_time_turns,costsPerUnit:t,effectsOnComplete:r,upkeepPerUnit:{metal:0,mineral:0,food:0,energy:0,research_points:0},isAbundanceScaled:!1,prerequisites:n}}(r);t[e.id]=e}return t}var T=JSON.parse('{"meta":{"version":"3.1.0","description":"Complete game definition from Infinite Conflict Units CSV. All unit and structure data sourced from official game manual. Research system added with 36 research items.","generated_at":"2025-10-25T17:00:00Z","updated_at":"2025-11-11T19:09:37.077Z"},"resources":[{"id":"metal","name":"Metal"},{"id":"mineral","name":"Mineral"},{"id":"food","name":"Food"},{"id":"energy","name":"Energy"},{"id":"ground_space","name":"Ground Space"},{"id":"orbital_space","name":"Orbital Space"},{"id":"research_points","name":"Research Points"}],"units":[{"id":"worker","name":"Worker","category":"colonist","tier":1,"build_time_turns":1,"cost":[],"build_requirements":{},"consumption":[{"type":"resource","id":"food","amount_per_100_pop":1},{"type":"housing","category":"worker","amount":1}],"requirements":[],"score_value":1},{"id":"soldier","name":"Soldier","category":"colonist","tier":2,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":12},{"type":"resource","id":"mineral","amount":8},{"type":"resource","id":"food","amount":20},{"type":"unit","id":"worker","amount":1,"is_consumed":true}],"build_requirements":{"workers_occupied":10},"consumption":[{"type":"resource","id":"food","amount_per_100_pop":1},{"type":"housing","category":"soldier","amount":1}],"requirements":[{"type":"structure","id":"army_barracks"}],"score_value":104},{"id":"scientist","name":"Scientist","category":"colonist","tier":1,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":5},{"type":"resource","id":"mineral","amount":20},{"type":"resource","id":"food","amount":25},{"type":"unit","id":"worker","amount":1,"is_consumed":true}],"build_requirements":{"workers_occupied":25},"consumption":[{"type":"resource","id":"food","amount_per_100_pop":1},{"type":"housing","category":"scientist","amount":1}],"requirements":[{"type":"structure","id":"research_lab"}],"score_value":208},{"id":"fighter","name":"Fighter","category":"ship","subcategory":"military","tier":2,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":1500},{"type":"resource","id":"mineral","amount":350}],"build_requirements":{"workers_occupied":500},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"},{"type":"structure","id":"light_weapons_factory"}],"score_value":5},{"id":"bomber","name":"Bomber","category":"ship","subcategory":"military","tier":2,"build_time_turns":6,"cost":[{"type":"resource","id":"metal","amount":1500},{"type":"resource","id":"mineral","amount":3000}],"build_requirements":{"workers_occupied":1500},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"},{"type":"structure","id":"light_weapons_factory"}],"score_value":10},{"id":"frigate","name":"Frigate","category":"ship","subcategory":"military","tier":2,"build_time_turns":10,"cost":[{"type":"resource","id":"metal","amount":17000},{"type":"resource","id":"mineral","amount":3800}],"build_requirements":{"workers_occupied":5000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"},{"type":"structure","id":"light_weapons_factory"}],"score_value":25},{"id":"outpost_ship","name":"Outpost Ship","category":"ship","subcategory":"colony","tier":1,"build_time_turns":16,"cost":[{"type":"resource","id":"metal","amount":30000},{"type":"resource","id":"mineral","amount":20000}],"build_requirements":{"workers_occupied":50000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"}],"score_value":100},{"id":"invasion_ship","name":"Invasion Ship","category":"ship","subcategory":"military","tier":2,"build_time_turns":16,"cost":[{"type":"resource","id":"metal","amount":25000},{"type":"resource","id":"mineral","amount":18000}],"build_requirements":{"workers_occupied":40000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"},{"type":"structure","id":"light_weapons_factory"}],"score_value":80},{"id":"freighter","name":"Freighter","category":"ship","subcategory":"transport","tier":1,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":24000},{"type":"resource","id":"mineral","amount":16000}],"build_requirements":{"workers_occupied":20000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"}],"special":"Stores up to 120000 metal and 80000 mineral; capacity of 40000 shared for energy, food and colonists","score_value":50},{"id":"cruiser","name":"Cruiser","category":"ship","subcategory":"military","tier":3,"build_time_turns":20,"cost":[{"type":"resource","id":"metal","amount":160000},{"type":"resource","id":"mineral","amount":37000}],"build_requirements":{"workers_occupied":50000},"consumption":[],"requirements":[{"type":"structure","id":"space_dock"},{"type":"structure","id":"light_weapons_factory"}],"score_value":200},{"id":"destroyer","name":"Destroyer","category":"ship","subcategory":"military","tier":3,"build_time_turns":14,"cost":[{"type":"resource","id":"metal","amount":25000},{"type":"resource","id":"mineral","amount":50000}],"build_requirements":{"workers_occupied":25000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"},{"type":"structure","id":"heavy_weapons_factory"}],"score_value":100},{"id":"battleship","name":"Battleship","category":"ship","subcategory":"military","tier":3,"build_time_turns":26,"cost":[{"type":"resource","id":"metal","amount":30000},{"type":"resource","id":"mineral","amount":600000}],"build_requirements":{"workers_occupied":300000},"consumption":[],"requirements":[{"type":"structure","id":"space_dock"},{"type":"structure","id":"heavy_weapons_factory"}],"score_value":800},{"id":"command_carrier","name":"Command Carrier","category":"ship","subcategory":"military","tier":3,"build_time_turns":48,"cost":[{"type":"resource","id":"metal","amount":1200000},{"type":"resource","id":"mineral","amount":800000}],"build_requirements":{"workers_occupied":500000},"consumption":[],"requirements":[{"type":"structure","id":"space_dock"},{"type":"structure","id":"heavy_weapons_factory"}],"score_value":2000},{"id":"merchant","name":"Merchant","category":"ship","subcategory":"transport","tier":1,"build_time_turns":10,"cost":[{"type":"resource","id":"metal","amount":48000},{"type":"resource","id":"mineral","amount":32000}],"build_requirements":{"workers_occupied":36000},"consumption":[],"requirements":[{"type":"structure","id":"shipyard"}],"special":"Stores up to 240000 metal and 160000 mineral; capacity of 80000 shared for energy, food and colonists","score_value":100},{"id":"trader","name":"Trader","category":"ship","subcategory":"transport","tier":3,"build_time_turns":12,"cost":[{"type":"resource","id":"metal","amount":72000},{"type":"resource","id":"mineral","amount":48000}],"build_requirements":{"workers_occupied":60000},"consumption":[],"requirements":[{"type":"structure","id":"space_dock"}],"special":"Stores up to 480000 metal and 320000 mineral; capacity of 160000 shared for energy, food and colonists","score_value":150}],"structures":[{"id":"outpost","name":"Outpost","tier":1,"is_advanced":false,"build_time_turns":0,"cost":[],"build_requirements":{"workers_occupied":0,"space_cost":[]},"requirements":[],"operations":{"production":[{"type":"metal","base_amount":300,"is_abundance_scaled":true},{"type":"mineral","base_amount":200,"is_abundance_scaled":true},{"type":"food","base_amount":100,"is_abundance_scaled":true},{"type":"energy","base_amount":100,"is_abundance_scaled":false}],"consumption":[],"effects":[{"type":"PROVIDE_HOUSING","category":"worker","amount":50000},{"type":"PROVIDE_HOUSING","category":"soldier","amount":100000}]},"max_per_planet":1,"description":"Starting structure; provides housing and basic production."},{"id":"farm","name":"Farm","tier":1,"is_advanced":false,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":1500},{"type":"resource","id":"mineral","amount":1000}],"build_requirements":{"workers_occupied":5000,"space_cost":[{"type":"ground_space","amount":1}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[{"type":"food","base_amount":100,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[]},"max_per_planet":null},{"id":"launch_site","name":"Launch Site","tier":1,"is_advanced":true,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":15000},{"type":"resource","id":"mineral","amount":10000}],"build_requirements":{"workers_occupied":25000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"UNLOCK_CATEGORY","category":"orbital_buildings"}]},"max_per_planet":1,"description":"Unlocks orbital buildings"},{"id":"leisure_centre","name":"Leisure Centre","tier":1,"is_advanced":true,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":12000},{"type":"resource","id":"mineral","amount":8000}],"build_requirements":{"workers_occupied":10000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"growth_bonus","value":0.005}]},"max_per_planet":1,"description":"Increases pop growth by +0.5%"},{"id":"living_quarters","name":"Living Quarters","tier":1,"is_advanced":false,"build_time_turns":6,"cost":[{"type":"resource","id":"metal","amount":2400},{"type":"resource","id":"mineral","amount":1600}],"build_requirements":{"workers_occupied":25000,"space_cost":[{"type":"ground_space","amount":1}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"PROVIDE_HOUSING","category":"worker","amount":50000}]},"max_per_planet":null},{"id":"metal_mine","name":"Metal Mine","tier":1,"is_advanced":false,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":600},{"type":"resource","id":"mineral","amount":2000}],"build_requirements":{"workers_occupied":5000,"space_cost":[{"type":"ground_space","amount":1}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[{"type":"metal","base_amount":300,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[]},"max_per_planet":null},{"id":"mineral_extractor","name":"Mineral Extractor","tier":1,"is_advanced":false,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":3000},{"type":"resource","id":"mineral","amount":400}],"build_requirements":{"workers_occupied":5000,"space_cost":[{"type":"ground_space","amount":1}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[{"type":"mineral","base_amount":200,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[]},"max_per_planet":null},{"id":"solar_generator","name":"Solar Generator","tier":1,"is_advanced":false,"build_time_turns":4,"cost":[{"type":"resource","id":"metal","amount":1500},{"type":"resource","id":"mineral","amount":1000}],"build_requirements":{"workers_occupied":5000,"space_cost":[{"type":"ground_space","amount":1}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[{"type":"energy","base_amount":100,"is_abundance_scaled":false}],"consumption":[],"effects":[]},"max_per_planet":null},{"id":"research_lab","name":"Research Lab","tier":1,"is_advanced":true,"build_time_turns":14,"cost":[{"type":"resource","id":"metal","amount":24000},{"type":"resource","id":"mineral","amount":16000}],"build_requirements":{"workers_occupied":25000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"PROVIDE_HOUSING","category":"scientist","amount":25000},{"type":"UNLOCK_CATEGORY","category":"scientist_training"}]},"max_per_planet":1,"description":"Unlocks scientist training"},{"id":"comms_satellite","name":"Comms Satellite","tier":1.5,"is_advanced":true,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":33000},{"type":"resource","id":"mineral","amount":22000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"orbital_space","amount":2}]},"requirements":[{"type":"structure","id":"launch_site"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"UNLOCK_CATEGORY","category":"radar_scanning"}]},"max_per_planet":1,"description":"Unlocks radar and scanning"},{"id":"habitat","name":"Habitat","tier":1.5,"is_advanced":false,"build_time_turns":6,"cost":[{"type":"resource","id":"metal","amount":4800},{"type":"resource","id":"mineral","amount":3200}],"build_requirements":{"workers_occupied":25000,"space_cost":[{"type":"orbital_space","amount":1}]},"requirements":[{"type":"structure","id":"launch_site"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[{"type":"PROVIDE_HOUSING","category":"worker","amount":50000}]},"max_per_planet":null},{"id":"shipyard","name":"Shipyard","tier":1.5,"is_advanced":true,"build_time_turns":12,"cost":[{"type":"resource","id":"metal","amount":48000},{"type":"resource","id":"mineral","amount":32000}],"build_requirements":{"workers_occupied":60000,"space_cost":[{"type":"orbital_space","amount":2}]},"requirements":[{"type":"structure","id":"launch_site"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"UNLOCK_CATEGORY","category":"ship_building"}]},"max_per_planet":1,"description":"Unlocks ship building"},{"id":"colony","name":"Colony","tier":2,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":60000},{"type":"resource","id":"mineral","amount":40000}],"build_requirements":{"workers_occupied":50000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"outpost"}],"operations":{"production":[],"consumption":[],"effects":[{"type":"PROVIDE_HOUSING","category":"worker","amount":100000},{"type":"UNLOCK_CATEGORY","category":"tier_2_buildings"}]},"max_per_planet":1,"description":"Unlocks tier 2 buildings"},{"id":"core_metal_mine","name":"Core Metal Mine","tier":2,"is_advanced":false,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":3600},{"type":"resource","id":"mineral","amount":12000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[{"type":"metal","base_amount":900,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[]},"max_per_planet":null},{"id":"core_mineral_extractor","name":"Core Mineral Extractor","tier":2,"is_advanced":false,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":18000},{"type":"resource","id":"mineral","amount":2400}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[{"type":"mineral","base_amount":600,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[]},"max_per_planet":null},{"id":"hydroponics_lab","name":"Hydroponics Lab","tier":2,"is_advanced":false,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":9000},{"type":"resource","id":"mineral","amount":6000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"orbital_space","amount":2}]},"requirements":[{"type":"structure","id":"launch_site"},{"type":"structure","id":"colony"}],"operations":{"production":[{"type":"food","base_amount":300,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[]},"max_per_planet":null},{"id":"light_weapons_factory","name":"Light Weapons Factory","tier":2,"is_advanced":true,"build_time_turns":12,"cost":[{"type":"resource","id":"metal","amount":30000},{"type":"resource","id":"mineral","amount":20000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"UNLOCK_CATEGORY","category":"warships_barracks"}]},"max_per_planet":1,"description":"Unlocks warships and army barracks"},{"id":"solar_array","name":"Solar Array","tier":2,"is_advanced":false,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":9000},{"type":"resource","id":"mineral","amount":6000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"orbital_space","amount":2}]},"requirements":[{"type":"structure","id":"launch_site"},{"type":"structure","id":"colony"}],"operations":{"production":[{"type":"energy","base_amount":300,"is_abundance_scaled":false}],"consumption":[],"effects":[]},"max_per_planet":null},{"id":"army_barracks","name":"Army Barracks","tier":2,"is_advanced":true,"build_time_turns":8,"cost":[{"type":"resource","id":"metal","amount":12000},{"type":"resource","id":"mineral","amount":8000}],"build_requirements":{"workers_occupied":25000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"light_weapons_factory"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"PROVIDE_HOUSING","category":"soldier","amount":400000},{"type":"UNLOCK_CATEGORY","category":"soldier_production"}]},"max_per_planet":null,"description":"Unlocks soldier production"},{"id":"hyperspace_beacon","name":"Hyperspace Beacon","tier":2.5,"is_advanced":true,"build_time_turns":16,"cost":[{"type":"resource","id":"metal","amount":39000},{"type":"resource","id":"mineral","amount":26000}],"build_requirements":{"workers_occupied":40000,"space_cost":[{"type":"orbital_space","amount":2}]},"requirements":[{"type":"structure","id":"launch_site"},{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"travel_time_reduction","value":0.5}]},"max_per_planet":1,"description":"Reduces travel time for incoming ships"},{"id":"hospital","name":"Hospital","tier":2.5,"is_advanced":true,"build_time_turns":10,"cost":[{"type":"resource","id":"metal","amount":36000},{"type":"resource","id":"mineral","amount":24000}],"build_requirements":{"workers_occupied":20000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"leisure_centre"},{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":20}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"growth_bonus","value":0.005}]},"max_per_planet":1,"description":"Increases pop growth by +0.5%"},{"id":"metal_refinery","name":"Metal Refinery","tier":2.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":75000},{"type":"resource","id":"mineral","amount":50000}],"build_requirements":{"workers_occupied":100000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":40}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"metal_abundance","value":0.3}]},"max_per_planet":1,"description":"Increases planet metal abundance by 30%"},{"id":"mineral_processor","name":"Mineral Processor","tier":2.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":75000},{"type":"resource","id":"mineral","amount":50000}],"build_requirements":{"workers_occupied":100000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":40}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"mineral_abundance","value":0.3}]},"max_per_planet":1,"description":"Increases planet mineral abundance by 30%"},{"id":"food_purifier","name":"Food Purifier","tier":2.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":75000},{"type":"resource","id":"mineral","amount":50000}],"build_requirements":{"workers_occupied":100000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":40}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"food_abundance","value":0.3}]},"max_per_planet":1,"description":"Increases planet food abundance by 30%"},{"id":"energy_booster","name":"Energy Booster","tier":2.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":75000},{"type":"resource","id":"mineral","amount":50000}],"build_requirements":{"workers_occupied":100000,"space_cost":[{"type":"ground_space","amount":2}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":40}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"energy_abundance","value":0.3}]},"max_per_planet":1,"description":"Increases planet energy abundance by 30%"},{"id":"metropolis","name":"Metropolis","tier":3,"is_advanced":true,"build_time_turns":48,"cost":[{"type":"resource","id":"metal","amount":120000},{"type":"resource","id":"mineral","amount":80000}],"build_requirements":{"workers_occupied":160000,"space_cost":[{"type":"ground_space","amount":4}]},"requirements":[{"type":"structure","id":"colony"}],"operations":{"production":[],"consumption":[],"effects":[{"type":"PROVIDE_HOUSING","category":"worker","amount":200000},{"type":"UNLOCK_CATEGORY","category":"tier_3_buildings"}]},"max_per_planet":1,"description":"Unlocks tier 3 buildings"},{"id":"space_dock","name":"Space Dock","tier":3,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":144000},{"type":"resource","id":"mineral","amount":96000}],"build_requirements":{"workers_occupied":240000,"space_cost":[]},"requirements":[{"type":"structure","id":"metropolis"},{"type":"structure","id":"shipyard"}],"operations":{"production":[],"consumption":[],"effects":[{"type":"UNLOCK_CATEGORY","category":"advanced_ships"}]},"max_per_planet":null,"description":"Allows construction of advanced capital ships"},{"id":"heavy_weapons_factory","name":"Heavy Weapons Factory","tier":3,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":90000},{"type":"resource","id":"mineral","amount":60000}],"build_requirements":{"workers_occupied":200000,"space_cost":[{"type":"ground_space","amount":4}]},"requirements":[{"type":"structure","id":"metropolis"},{"type":"structure","id":"light_weapons_factory"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":10}],"effects":[{"type":"UNLOCK_CATEGORY","category":"heavy_warships"}]},"max_per_planet":1,"description":"Unlocks Destroyers and Battleships"},{"id":"land_reclamation","name":"Land Reclamation","tier":3,"is_advanced":false,"build_time_turns":24,"cost":[],"build_requirements":{"workers_occupied":100000,"space_cost":[]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[],"consumption":[],"effects":[{"type":"PROVIDE_SPACE","space_type":"ground","amount":1}]},"max_per_planet":null,"description":"Increases planet max ground space by 1"},{"id":"orbital_clearing","name":"Orbital Clearing","tier":3,"is_advanced":false,"build_time_turns":24,"cost":[],"build_requirements":{"workers_occupied":100000,"space_cost":[]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[],"consumption":[],"effects":[{"type":"PROVIDE_SPACE","space_type":"orbital","amount":1}]},"max_per_planet":null,"description":"Increases planet max orbital space by 1"},{"id":"jump_gate","name":"Jump Gate","tier":3.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":156000},{"type":"resource","id":"mineral","amount":104000}],"build_requirements":{"workers_occupied":160000,"space_cost":[{"type":"orbital_space","amount":4}]},"requirements":[{"type":"structure","id":"launch_site"},{"type":"structure","id":"metropolis"}],"operations":{"production":[],"consumption":[{"type":"resource","id":"energy","amount":40}],"effects":[{"type":"MODIFY_ATTRIBUTE","attribute":"jump_gate_active","value":1}]},"max_per_planet":1,"description":"Reduces travel time for incoming friendly ships, required on origin and destination"},{"id":"strip_metal_mine","name":"Strip Metal Mine","tier":3.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":72000},{"type":"resource","id":"mineral","amount":240000}],"build_requirements":{"workers_occupied":200000,"space_cost":[{"type":"ground_space","amount":6}]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[{"type":"metal","base_amount":9000,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":60}],"effects":[]},"max_per_planet":1},{"id":"strip_mineral_extractor","name":"Strip Mineral Extractor","tier":3.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":360000},{"type":"resource","id":"mineral","amount":48000}],"build_requirements":{"workers_occupied":200000,"space_cost":[{"type":"ground_space","amount":6}]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[{"type":"mineral","base_amount":6000,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":60}],"effects":[]},"max_per_planet":1},{"id":"hydroponics_dome","name":"Hydroponics Dome","tier":3.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":180000},{"type":"resource","id":"mineral","amount":120000}],"build_requirements":{"workers_occupied":200000,"space_cost":[{"type":"orbital_space","amount":6}]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[{"type":"food","base_amount":3000,"is_abundance_scaled":true}],"consumption":[{"type":"resource","id":"energy","amount":60}],"effects":[]},"max_per_planet":1},{"id":"solar_station","name":"Solar Station","tier":3.5,"is_advanced":true,"build_time_turns":24,"cost":[{"type":"resource","id":"metal","amount":180000},{"type":"resource","id":"mineral","amount":120000}],"build_requirements":{"workers_occupied":200000,"space_cost":[{"type":"orbital_space","amount":6}]},"requirements":[{"type":"structure","id":"metropolis"}],"operations":{"production":[{"type":"energy","base_amount":3000,"is_abundance_scaled":false}],"consumption":[],"effects":[]},"max_per_planet":1}],"research":[{"id":"planet_management","name":"Planet Management","category":"research","tier":1,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":100}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":[],"operations":[{"type":"on_complete","effect":"unlock_research","items":["pl_6"]}],"score_value":1},{"id":"resource_collection","name":"Resource Collection","category":"research","tier":1,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":100}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":[],"operations":[{"type":"on_complete","effect":"unlock_research","items":["core_metal_mine_research","core_mineral_extractor_research","hydroponics_lab_research","solar_array_research","mass_production","land_enhancement"]}],"score_value":1},{"id":"fleet_technology","name":"Fleet Technology","category":"research","tier":1,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":100}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":[],"operations":[{"type":"on_complete","effect":"unlock_research","items":["merchant_research","trader_research","war_ship_design","warp_theory"]}],"score_value":1},{"id":"pl_6","name":"PL 6","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":500}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["planet_management"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":6}],"score_value":5},{"id":"pl_8","name":"PL 8","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":100}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_6"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":8}],"score_value":1},{"id":"pl_10","name":"PL 10","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":2000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_8"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":10}],"score_value":20},{"id":"pl_12","name":"PL 12","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_10"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":12}],"score_value":50},{"id":"pl_14","name":"PL 14","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_12"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":14}],"score_value":50},{"id":"pl_16","name":"PL 16","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":10000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_14"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":16}],"score_value":100},{"id":"pl_18","name":"PL 18","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":10000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_16"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":18}],"score_value":100},{"id":"pl_20","name":"PL 20","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":25000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_18"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":20}],"score_value":250},{"id":"pl_22","name":"PL 22","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":25000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_20"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":22}],"score_value":250},{"id":"pl_24","name":"PL 24","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":25000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["pl_22"],"operations":[{"type":"on_complete","effect":"set_planet_limit","value":24}],"score_value":250},{"id":"merchant_research","name":"Merchant Research","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":10000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["fleet_technology"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"merchant"}],"score_value":100},{"id":"trader_research","name":"Trader Research","category":"research","tier":1.5,"build_time_turns":72,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["fleet_technology"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"trader"}],"score_value":500},{"id":"war_ship_design","name":"War Ship Design","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":2000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["fleet_technology"],"operations":[{"type":"on_complete","effect":"unlock_research","items":["destroyer_research","cruiser_research","battleship_research"]}],"score_value":20},{"id":"warp_theory","name":"Warp Theory","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["fleet_technology"],"operations":[{"type":"on_complete","effect":"unlock_research","items":["hyperspace_beacon_research","jump_gate_research"]}],"score_value":50},{"id":"destroyer_research","name":"Destroyer Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":20000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["war_ship_design"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"destroyer"}],"score_value":200},{"id":"cruiser_research","name":"Cruiser Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":100000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["war_ship_design"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"cruiser"}],"score_value":1000},{"id":"battleship_research","name":"Battleship Research","category":"research","tier":2,"build_time_turns":144,"cost":[{"type":"resource","id":"research_points","amount":500000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["war_ship_design"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"battleship"}],"score_value":5000},{"id":"hyperspace_beacon_research","name":"Hyperspace Beacon Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["warp_theory"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"hyperspace_beacon"}],"score_value":500},{"id":"jump_gate_research","name":"Jump Gate Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["warp_theory"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"jump_gate"}],"score_value":500},{"id":"core_metal_mine_research","name":"Core Metal Mine Research","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"core_metal_mine"}],"score_value":50},{"id":"core_mineral_extractor_research","name":"Core Mineral Extractor Research","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"core_mineral_extractor"}],"score_value":50},{"id":"hydroponics_lab_research","name":"Hydroponics Lab Research","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"hydroponics_lab"}],"score_value":50},{"id":"solar_array_research","name":"Solar Array Research","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":5000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"solar_array"}],"score_value":50},{"id":"mass_production","name":"Mass Production","category":"research","tier":1.5,"build_time_turns":48,"cost":[{"type":"resource","id":"research_points","amount":12000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_research","items":["strip_metal_mine_research","strip_mineral_extractor_research","hydroponics_dome_research","solar_station_research"]}],"score_value":120},{"id":"land_enhancement","name":"Land Enhancement","category":"research","tier":1.5,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":25000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["resource_collection"],"operations":[{"type":"on_complete","effect":"unlock_research","items":["metal_refinery_research","mineral_processor_research","food_purifier_research","energy_booster_research"]}],"score_value":250},{"id":"metal_refinery_research","name":"Metal Refinery Research","category":"research","tier":2,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["land_enhancement"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"metal_refinery"}],"score_value":500},{"id":"mineral_processor_research","name":"Mineral Processor Research","category":"research","tier":2,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["land_enhancement"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"mineral_processor"}],"score_value":500},{"id":"food_purifier_research","name":"Food Purifier Research","category":"research","tier":2,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["land_enhancement"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"food_purifier"}],"score_value":500},{"id":"energy_booster_research","name":"Energy Booster Research","category":"research","tier":2,"build_time_turns":24,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["land_enhancement"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"energy_booster"}],"score_value":500},{"id":"strip_metal_mine_research","name":"Strip Metal Mine Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["mass_production"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"strip_metal_mine"}],"score_value":500},{"id":"strip_mineral_extractor_research","name":"Strip Mineral Extractor Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["mass_production"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"strip_mineral_extractor"}],"score_value":500},{"id":"hydroponics_dome_research","name":"Hydroponics Dome Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["mass_production"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"hydroponics_dome"}],"score_value":500},{"id":"solar_station_research","name":"Solar Station Research","category":"research","tier":2,"build_time_turns":96,"cost":[{"type":"resource","id":"research_points","amount":50000}],"build_requirements":{"workers_occupied":0},"consumption":[],"requirements":["mass_production"],"operations":[{"type":"on_complete","effect":"unlock_structure","item":"solar_station"}],"score_value":500}]}');let I=N(T);function j(e,t){if(!e.planets.has(t))throw Error("Planet ".concat(t," does not exist"));return{...e,currentPlanetId:t}}function C(e,t){let r=e.lanes[t],n=[];for(let t of[...r.completionHistory].reverse()){let r=e.defs[t.itemId],s=t.isWait?"Wait":(null==r?void 0:r.name)||"Unknown";n.push({id:t.id,itemId:t.itemId,itemName:s,status:"completed",quantity:t.quantity,turnsRemaining:0,eta:null,queuedTurn:t.queuedTurn,startTurn:t.startTurn,completionTurn:t.completionTurn})}let s=1;if(r.completionHistory.length>0){let e=r.completionHistory[r.completionHistory.length-1];e.completionTurn&&(s=e.completionTurn+1)}r.active&&(s=r.active.completionTurn?r.active.completionTurn+1:e.currentTurn+r.active.turnsRemaining);for(let t=0;t<r.pendingQueue.length;t++){let a=r.pendingQueue[t],i=e.defs[a.itemId],o=a.isWait?a.turnsRemaining:(null==i?void 0:i.durationTurns)||4,l=a.isWait?"Wait":(null==i?void 0:i.name)||"Unknown",u=s,c=s+o-1;n.push({id:a.id,itemId:a.itemId,itemName:l,status:"pending",quantity:a.quantity,turnsRemaining:a.turnsRemaining,eta:c,queuedTurn:a.queuedTurn,startTurn:u,completionTurn:c}),s=c+1}if(r.active){let t=e.defs[r.active.itemId],s=r.active.isWait?"Wait":(null==t?void 0:t.name)||"Unknown",a=e.currentTurn+r.active.turnsRemaining;n.push({id:r.active.id,itemId:r.active.itemId,itemName:s,status:"active",quantity:r.active.quantity,turnsRemaining:r.active.turnsRemaining,eta:a,queuedTurn:r.active.queuedTurn,startTurn:r.active.startTurn,completionTurn:r.active.completionTurn})}return n.reverse(),{laneId:t,entries:n}}var q=r(2667),S=r.n(q);function E(e){return{n:e.name,t:e.startTurn,a:[e.abundance.metal,e.abundance.mineral,e.abundance.food,e.abundance.energy,e.abundance.research_points],s:[e.space.groundCap,e.space.orbitalCap]}}class U{recordQueue(e,t,r,n){this.commands.push(["q",e,t,r,n])}recordCancel(e,t,r){this.commands.push(["c",e,t,r])}recordReorder(e,t,r,n){this.commands.push(["r",e,t,r,n])}recordAdvance(e,t){this.commands.push(["a",e,t])}recordAddPlanet(e){this.commands.push(["p",e]),this.planetConfigs.push(e)}recordSwitchPlanet(e){this.commands.push(["s",e])}recordQueueResearch(e){this.commands.push(["qr",e])}getCommands(){return[...this.commands]}getPlanetConfigs(){return[...this.planetConfigs]}clear(){this.commands=[],this.planetConfigs=[]}constructor(){this.commands=[],this.planetConfigs=[]}}function R(e,t){let r=JSON.stringify({v:1,planets:e.map(E),cmds:t});return S().compressToEncodedURIComponent(r)}function O(e){let{currentTurn:t,totalTurns:r,onTurnChange:a}=e,[i,o]=(0,s.useState)(null),l=e=>{a(e)},u=[1,50,100,150,200].filter(e=>e<=r);return(0,n.jsx)("div",{className:"w-full bg-pink-nebula-panel/50 rounded-lg border border-pink-nebula-border p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-pink-nebula-muted text-xs font-semibold",children:"TURN"}),(0,n.jsx)("input",{type:"number",value:t,onChange:e=>{let t=parseInt(e.target.value,10);!isNaN(t)&&t>=1&&t<=r&&a(t)},min:1,max:r,"aria-label":"Turn",className:"w-16 px-2 py-1 bg-pink-nebula-bg border border-pink-nebula-border rounded text-pink-nebula-text text-center font-bold"}),(0,n.jsxs)("span",{className:"text-pink-nebula-muted text-xs",children:["/ ",r]})]}),(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)("div",{className:"relative h-6 mb-1",children:u.map(e=>{let s=(e-1)/(r-1)*100,a=e===t;return(0,n.jsx)("div",{className:"absolute flex flex-col items-center cursor-pointer hover:text-pink-nebula-text transition-colors",style:{left:"".concat(s,"%"),transform:"translateX(-50%)"},onClick:()=>l(e),children:(0,n.jsx)("span",{className:"text-xs font-mono ".concat(a?"text-pink-nebula-accent-primary font-bold":"text-pink-nebula-muted"),children:e})},e)})}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"absolute inset-0 flex justify-between pointer-events-none",children:u.map(e=>{let t=(e-1)/(r-1)*100;return(0,n.jsx)("div",{className:"absolute w-[2px] h-2 bg-pink-nebula-border",style:{left:"".concat(t,"%"),transform:"translateX(-50%)",top:"-4px"}},e)})}),(0,n.jsx)("div",{className:"absolute top-[-6px] w-[3px] h-3 bg-pink-nebula-accent-primary rounded pointer-events-none",style:{left:"".concat((t-1)/(r-1)*100,"%"),transform:"translateX(-50%)"}}),(0,n.jsx)("input",{type:"range",min:1,max:r,step:1,value:t,onChange:e=>{a(parseInt(e.target.value,10))},onMouseMove:e=>{let t=e.currentTarget.getBoundingClientRect();o(Math.round((e.clientX-t.left)/t.width*(r-1)+1))},onMouseLeave:()=>o(null),className:"w-full h-2 bg-pink-nebula-border rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-pink-nebula-accent-primary [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:transition-transform [&::-webkit-slider-thumb]:duration-75 [&::-webkit-slider-thumb]:hover:scale-110 [&::-webkit-slider-thumb]:active:scale-95 [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 [&::-moz-range-thumb]:bg-pink-nebula-accent-primary [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:transition-transform [&::-moz-range-thumb]:duration-75","aria-label":"Turn slider"})]}),null!==i&&i!==t&&(0,n.jsxs)("div",{className:"absolute bottom-full mb-2 px-2 py-1 bg-pink-nebula-bg border border-pink-nebula-border rounded text-xs text-pink-nebula-text pointer-events-none whitespace-nowrap",style:{left:"".concat((i-1)/(r-1)*100,"%"),transform:"translateX(-50%)"},children:["Turn ",i]})]}),(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("button",{onClick:()=>a(1),className:"text-xs py-1 px-3 bg-pink-nebula-bg hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded transition-colors",children:"Start"}),(0,n.jsx)("button",{onClick:()=>a(Math.round(r/2)),className:"text-xs py-1 px-3 bg-pink-nebula-bg hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded transition-colors",children:"Mid"}),(0,n.jsx)("button",{onClick:()=>a(r),className:"text-xs py-1 px-3 bg-pink-nebula-bg hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded transition-colors",children:"End"})]})]})})}var L=r(1994),M=r(3335);function D(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,M.m6)((0,L.W)(t))}let P=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("glass-card text-card-foreground",r),...s})});P.displayName="Card",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("flex flex-col space-y-1.5 p-6",r),...s})}).displayName="CardHeader",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("text-2xl font-semibold leading-none tracking-tight",r),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("p-6 pt-0",r),...s})}).displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:D("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";let A=s.memo(function(e){let{summary:t,defs:r,turnsToHousingCap:a}=e,i=(0,s.useMemo)(()=>e=>Math.floor(e).toLocaleString("de-DE"),[]),o=(0,s.useMemo)(()=>e=>e>=1e3?"".concat(Math.floor(e/1e3),"k"):e.toString(),[]),l=(0,s.useMemo)(()=>e=>{let t=(Math.round(10*e)/10).toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:1});return e>=0?"+".concat(t):t},[]),u=e=>"".concat((100*e).toFixed(0),"%");Object.entries(t.ships).map(e=>{let[t,r]=e;return{id:t,name:t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),count:r}});let c=(0,s.useMemo)(()=>{let e=Object.entries(t.structures).map(e=>{var t,n,s,a,i,o,l,u,c;let[d,p]=e,m=r[d],h=(null==m?void 0:m.name)||d.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),b=(null==m?void 0:null===(t=m.effectsOnComplete)||void 0===t?void 0:t.production_metal)||0,_=(null==m?void 0:null===(n=m.effectsOnComplete)||void 0===n?void 0:n.production_mineral)||0,g=(null==m?void 0:null===(s=m.effectsOnComplete)||void 0===s?void 0:s.production_food)||0,y=(null==m?void 0:null===(a=m.effectsOnComplete)||void 0===a?void 0:a.production_energy)||0,f=(null==m?void 0:null===(i=m.upkeepPerUnit)||void 0===i?void 0:i.metal)||0,x=(null==m?void 0:null===(o=m.upkeepPerUnit)||void 0===o?void 0:o.mineral)||0,v=(null==m?void 0:null===(l=m.upkeepPerUnit)||void 0===l?void 0:l.food)||0,k=(null==m?void 0:null===(u=m.upkeepPerUnit)||void 0===u?void 0:u.energy)||0,w=(null==m?void 0:m.subcategory)==="orbital_facility",N=((null==m?void 0:null===(c=m.costsPerUnit)||void 0===c?void 0:c.space)||0)*p;return{id:d,name:h,count:p,tier:(null==m?void 0:m.tier)||0,durationTurns:(null==m?void 0:m.durationTurns)||0,metalNet:(b-f)*p,mineralNet:(_-x)*p,foodNet:(g-v)*p,energyNet:(y-k)*p,space:N,isOrbital:w}});return e.sort((e,t)=>e.tier!==t.tier?e.tier-t.tier:e.durationTurns!==t.durationTurns?e.durationTurns-t.durationTurns:e.name.localeCompare(t.name)),e},[t.structures,r]);return(0,n.jsx)("div",{className:"w-full max-w-[1800px] mx-auto px-6 my-4",children:(0,n.jsxs)(P,{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 p-4 glow-tyr border-gray-400/30",children:[(0,n.jsxs)(P,{className:"p-3",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-pink-nebula-muted mb-3",children:"Resources"}),(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-xs text-pink-nebula-muted border-b border-pink-nebula-border",children:[(0,n.jsx)("th",{className:"text-left pb-2 w-20",children:"Type"}),(0,n.jsx)("th",{className:"text-right pb-2 w-24",children:"Stock"}),(0,n.jsx)("th",{className:"text-right pb-2 w-14",children:"Abund"}),(0,n.jsx)("th",{className:"text-right pb-2 w-20",children:"Output/T"})]})}),(0,n.jsx)("tbody",{children:[{id:"metal",label:"Metal",color:"text-gray-300"},{id:"mineral",label:"Mineral",color:"text-red-500"},{id:"food",label:"Food",color:"text-green-500"},{id:"energy",label:"Energy",color:"text-blue-400"},{id:"research_points",label:"RP",color:"text-purple-400"}].map(e=>{let r=t.stocks[e.id],s=t.abundance[e.id],a=t.outputsPerTurn[e.id];return(0,n.jsxs)("tr",{className:"border-b border-pink-nebula-border/50 last:border-0",children:[(0,n.jsx)("td",{className:"py-2 font-semibold w-20 ".concat(e.color),children:e.label}),(0,n.jsx)("td",{className:"text-right py-2 text-pink-nebula-text font-mono w-24",children:i(r)}),(0,n.jsx)("td",{className:"text-right py-2 text-pink-nebula-muted font-mono w-14",children:u(s)}),(0,n.jsx)("td",{className:"text-right py-2 font-semibold font-mono w-20 ".concat(e.color),children:l(a)})]},e.id)})})]})]}),(0,n.jsxs)(P,{className:"p-3",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-pink-nebula-muted mb-3",children:"Population"}),(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-xs text-pink-nebula-muted border-b border-pink-nebula-border",children:[(0,n.jsx)("th",{className:"text-left pb-2 w-24",children:"Type"}),(0,n.jsx)("th",{className:"text-right pb-2 w-24",children:"Count"}),(0,n.jsx)("th",{className:"text-right pb-2 w-14",children:"Cap"})]})}),(0,n.jsxs)("tbody",{children:[(0,n.jsxs)("tr",{className:"border-b border-pink-nebula-border/50",children:[(0,n.jsx)("td",{className:"py-2 text-orange-400 font-semibold w-24",children:"Workers"}),(0,n.jsxs)("td",{className:"text-right py-2 text-orange-400 font-mono w-24",children:[i(t.population.workersTotal)," (",i(t.population.workersBusy),")"]}),(0,n.jsx)("td",{className:"text-right py-2 text-pink-nebula-muted font-mono w-14",children:o(t.housing.workerCap)})]}),(0,n.jsxs)("tr",{className:"border-b border-pink-nebula-border/50",children:[(0,n.jsx)("td",{className:"py-2 text-red-300 font-semibold w-24",children:"Soldiers"}),(0,n.jsx)("td",{className:"text-right py-2 text-red-300 font-mono w-24",children:i(t.population.soldiers)}),(0,n.jsx)("td",{className:"text-right py-2 text-pink-nebula-muted font-mono w-14",children:o(t.housing.soldierCap)})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"py-2 text-yellow-400 font-semibold w-24",children:"Scientists"}),(0,n.jsx)("td",{className:"text-right py-2 text-yellow-400 font-mono w-24",children:i(t.population.scientists)}),(0,n.jsx)("td",{className:"text-right py-2 text-pink-nebula-muted font-mono w-14",children:o(t.housing.scientistCap)})]})]})]}),(0,n.jsxs)("div",{className:"mt-2 pt-2 border-t border-pink-nebula-border/50 text-xs space-y-1",children:[(0,n.jsxs)("div",{className:"text-pink-nebula-muted",children:["Idle workers: ",i(t.population.workersIdle)]}),(0,n.jsx)("div",{className:"text-green-400 font-semibold",children:t.growthHint}),null!=a&&a<=6&&(0,n.jsxs)("div",{className:"text-yellow-500 font-semibold pt-1",children:[" Workers will reach housing cap in ",a," turn",1!==a?"s":""]})]})]}),(0,n.jsxs)(P,{className:"p-3",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-pink-nebula-muted mb-3",children:"Space Remaining"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-xs mb-1",children:[(0,n.jsx)("span",{className:"text-amber-600 font-semibold",children:"Ground"}),(0,n.jsx)("span",{className:"text-amber-600 font-mono",children:t.space.groundCap-t.space.groundUsed})]}),(0,n.jsx)("div",{className:"w-full bg-pink-nebula-panel rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-amber-600 h-2 rounded-full transition-all",style:{width:"".concat(Math.min(100,(t.space.groundCap-t.space.groundUsed)/t.space.groundCap*100),"%")}})})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-xs mb-1",children:[(0,n.jsx)("span",{className:"text-blue-600 font-semibold",children:"Orbital"}),(0,n.jsx)("span",{className:"text-blue-600 font-mono",children:t.space.orbitalCap-t.space.orbitalUsed})]}),(0,n.jsx)("div",{className:"w-full bg-pink-nebula-panel rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(Math.min(100,(t.space.orbitalCap-t.space.orbitalUsed)/t.space.orbitalCap*100),"%")}})})]}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,n.jsx)("span",{className:"text-purple-500 font-semibold",children:"Planet Limit"}),(0,n.jsx)("span",{className:"text-purple-500 font-mono",children:t.planetLimit||4})]}),(0,n.jsx)("div",{className:"w-full bg-pink-nebula-panel rounded-full h-2 mt-1",children:(0,n.jsx)("div",{className:"bg-purple-500 h-2 rounded-full transition-all",style:{width:"".concat(Math.min(100,(t.planetLimit||4)/24*100),"%")}})}),(0,n.jsx)("div",{className:"text-xs text-pink-nebula-muted mt-1",children:"Max planets you can control"})]})]})]}),(0,n.jsxs)(P,{className:"p-3",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-pink-nebula-muted mb-3",children:"Buildings"}),c.length>0?(0,n.jsxs)("div",{className:"max-h-[224px] overflow-y-auto",children:[" ",(0,n.jsxs)("table",{className:"w-full text-xs font-mono",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-[10px] text-pink-nebula-muted border-b border-pink-nebula-border sticky top-0 bg-pink-nebula-panel",children:[(0,n.jsx)("th",{className:"pb-1 pr-2 text-right w-8",children:"Sp"}),(0,n.jsx)("th",{className:"pb-1 pr-2 text-left w-32",children:"Building"}),(0,n.jsx)("th",{className:"pb-1 pr-2 text-right w-10",children:"Qty"}),(0,n.jsx)("th",{className:"pb-1 pr-1 text-right w-12 text-gray-300",children:"M"}),(0,n.jsx)("th",{className:"pb-1 pr-1 text-right w-12 text-red-500",children:"Mn"}),(0,n.jsx)("th",{className:"pb-1 pr-1 text-right w-12 text-green-500",children:"F"}),(0,n.jsx)("th",{className:"pb-1 text-right w-14 text-blue-400",children:"E"})]})}),(0,n.jsx)("tbody",{children:c.map(e=>{let t=e.isOrbital?"text-blue-600":"text-amber-600",r=e.space>0?e.space.toString():"",s=[];if(0!==e.metalNet){let t=e.metalNet>0?"+":"";s.push("".concat(t).concat(e.metalNet))}if(0!==e.mineralNet){let t=e.mineralNet>0?"+":"";s.push("".concat(t).concat(e.mineralNet))}if(0!==e.foodNet){let t=e.foodNet>0?"+":"";s.push("".concat(t).concat(e.foodNet))}let a="";if(0!==e.energyNet){let t=e.energyNet>0?"+":"";a="".concat(t).concat(e.energyNet,"")}return(0,n.jsxs)("tr",{className:"border-b border-pink-nebula-border/50 last:border-0",children:[(0,n.jsx)("td",{className:"py-1.5 pr-2 text-right w-8 ".concat(t," font-semibold"),children:r}),(0,n.jsx)("td",{className:"py-1.5 pr-2 text-pink-nebula-text font-semibold w-32",children:e.name}),(0,n.jsxs)("td",{className:"py-1.5 pr-2 text-right text-pink-nebula-text w-10",children:["\xd7",e.count]}),(0,n.jsx)("td",{className:"py-1.5 pr-1 text-right w-12 text-gray-300",children:0!==e.metalNet?(e.metalNet>0?"+":"")+e.metalNet:""}),(0,n.jsx)("td",{className:"py-1.5 pr-1 text-right w-12 text-red-500",children:0!==e.mineralNet?(e.mineralNet>0?"+":"")+e.mineralNet:""}),(0,n.jsx)("td",{className:"py-1.5 pr-1 text-right w-12 text-green-500",children:0!==e.foodNet?(e.foodNet>0?"+":"")+e.foodNet:""}),(0,n.jsx)("td",{className:"py-1.5 text-right w-14 text-blue-400",children:a})]},e.id)})})]})]}):(0,n.jsx)("div",{className:"text-xs text-pink-nebula-muted text-center py-4",children:"No buildings"})]})]})})}),F=s.memo(function(e){let{entry:t,currentTurn:r,onCancel:a,onQuantityChange:i,maxQuantity:o,disabled:l=!1,isNewest:u=!1,def:c,busyWorkers:d=0,showQuantityInput:p=!1}=e,[m,h]=(0,s.useState)(!1),[b,_]=(0,s.useState)(!1),[g,y]=(0,s.useState)(t.quantity.toString());(0,s.useEffect)(()=>{if(m){let e=setTimeout(()=>{h(!1)},3e3);return()=>clearTimeout(e)}},[m]);let f=()=>{l||"completed"===t.status||(m?a():h(!0))},x=()=>{_(!1);let e=parseInt(g)||1,r=o?Math.min(Math.max(1,e),o):Math.max(1,e);r!==t.quantity&&i&&i(r),y(r.toString())},v="active"===t.status?"border-l-4 border-l-yellow-500":"pending"===t.status?"border-l-4 border-l-blue-500":"completed"===t.status?"border-l-4 border-l-green-500 opacity-70":"";return m?(0,n.jsx)("button",{onClick:f,className:"w-full text-left p-3 bg-red-900/30 border border-red-500 rounded ring-2 ring-red-500 hover:bg-red-900/40 transition-colors",title:"Click again to confirm removal",children:(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsxs)("span",{className:"font-semibold text-red-400",children:["Remove ",t.itemName,"?"]}),(0,n.jsx)("span",{className:"text-red-400 font-bold text-xs",children:"CLICK TO CONFIRM"})]})}):(0,n.jsxs)("button",{onClick:f,disabled:l||"completed"===t.status,className:"\n        w-full text-left p-3 bg-pink-nebula-panel/50 border border-pink-nebula-border rounded\n        hover:bg-pink-nebula-panel/70 transition-colors group\n        ".concat(v,"\n        ").concat(t.invalid?"border-orange-500/50 bg-orange-900/10":"","\n        ").concat(l||"completed"===t.status?"cursor-default":"cursor-pointer","\n      "),children:[(0,n.jsxs)("div",{className:"grid grid-cols-[auto_1fr_auto_auto_auto] gap-x-4 items-center text-sm font-mono",children:[(0,n.jsx)("div",{className:"text-pink-nebula-muted w-24",children:(()=>{var e,r,n;let s=null!==(r=null!==(e=t.startTurn)&&void 0!==e?e:t.queuedTurn)&&void 0!==r?r:"?",a=null!==(n=t.completionTurn)&&void 0!==n?n:null!==t.eta?t.eta:"?";return"T".concat(s," - T").concat(a)})()}),(0,n.jsx)("div",{className:"text-pink-nebula-text truncate",children:t.itemName}),(0,n.jsx)("div",{className:"text-pink-nebula-text text-right w-12",children:p&&!l&&"completed"!==t.status?(0,n.jsx)("input",{type:"number",min:"1",max:o,value:g,onChange:e=>y(e.target.value),onFocus:()=>_(!0),onBlur:x,onKeyDown:e=>{"Enter"===e.key?x():"Escape"===e.key&&(_(!1),y(t.quantity.toString()))},onClick:e=>e.stopPropagation(),className:"w-12 px-1 py-0 bg-pink-nebula-bg border border-pink-nebula-border rounded text-pink-nebula-text text-sm text-center focus:outline-none focus:border-pink-nebula-accent-primary font-mono",disabled:l}):(0,n.jsxs)("span",{children:["\xd7",t.quantity]})}),(0,n.jsx)("div",{className:"text-pink-nebula-text text-right w-10",children:void 0!==t.turnsRemaining?"".concat(t.turnsRemaining,"T"):"".concat((null==c?void 0:c.duration)||"","T")}),(0,n.jsx)("div",{className:"w-4 text-right",children:!l&&"completed"!==t.status&&(0,n.jsx)("span",{className:"text-gray-500 group-hover:text-pink-nebula-accent-primary transition-colors",children:""})})]}),t.invalid&&t.invalidReason&&(0,n.jsxs)("div",{className:"mt-1 text-xs text-orange-400",children:[" ",t.invalidReason]})]})},(e,t)=>e.entry.id===t.entry.id&&e.entry.status===t.entry.status&&e.entry.quantity===t.entry.quantity&&e.entry.eta===t.entry.eta&&e.entry.startTurn===t.entry.startTurn&&e.entry.queuedTurn===t.entry.queuedTurn&&e.entry.completionTurn===t.entry.completionTurn&&e.entry.invalid===t.entry.invalid&&e.currentTurn===t.currentTurn&&e.maxQuantity===t.maxQuantity&&e.disabled===t.disabled&&e.isNewest===t.isNewest&&e.busyWorkers===t.busyWorkers&&e.showQuantityInput===t.showQuantityInput),Q=s.memo(function(e){let{buildingLane:t,shipLane:r,colonistLane:a,researchLane:i,currentTurn:o,onCancel:l,onQuantityChange:u,getMaxQuantity:c,onReorder:d,disabled:p=!1,defs:m,activeTab:h,onTabChange:b}=e,[_,g]=(0,s.useState)("building"),[y,f]=(0,s.useState)(null),[x,v]=(0,s.useState)(null),k=null!=h?h:_,w=null!=b?b:g,N=e=>{switch(e){case"building":return{title:"Structures",icon:"\uD83C\uDFD7",laneView:t};case"ship":return{title:"Ships",icon:"\uD83D\uDE80",laneView:r};case"colonist":return{title:"Colonists",icon:"\uD83D\uDC65",laneView:a};case"research":return{title:"Research",icon:"\uD83D\uDD2C",laneView:i};default:return{title:"Unknown",icon:"",laneView:t}}},T=N(k),I=T.laneView,j=(null==I?void 0:I.entries.filter(e=>"completed"!==e.status))||[],C=j.length>0?j[j.length-1].id:null;return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("div",{className:"flex gap-2 mb-4",children:["building","ship","colonist","research"].map(e=>{let t=N(e),r=k===e;return(0,n.jsxs)("button",{onClick:()=>w(e),className:"\n                px-4 py-2 rounded-t-lg font-semibold transition-all duration-[350ms]\n                ".concat(r?"bg-slate-800 text-pink-nebula-text border-b-2 border-pink-nebula-accent-primary":"bg-slate-700 text-pink-nebula-muted hover:bg-slate-750","\n              "),children:[(0,n.jsx)("span",{className:"mr-2",children:t.icon}),t.title]},e)})}),(0,n.jsxs)(P,{className:"p-4 h-[600px] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-pink-nebula-border",children:[(0,n.jsx)("span",{className:"text-xl",children:T.icon}),(0,n.jsx)("h3",{className:"text-lg font-bold text-pink-nebula-text",children:T.title}),(0,n.jsx)("span",{className:"ml-auto text-sm text-pink-nebula-muted",children:I&&I.entries.length>0?"".concat(I.entries.length):""})]}),(0,n.jsx)("div",{className:"space-y-2",children:I&&0!==I.entries.length?I.entries.slice().reverse().map((e,t)=>{var r;let s=e.id===C,a=m[e.itemId],i=(null==a?void 0:null===(r=a.costsPerUnit)||void 0===r?void 0:r.workers)?a.costsPerUnit.workers*e.quantity:0,h="ship"===k||"colonist"===k,b=c?c(k,e):void 0,_=I.entries.length-1-t,g=(null==y?void 0:y.entryId)===e.id&&(null==y?void 0:y.laneId)===k,w=!p&&"pending"===e.status&&!!d;return(0,n.jsx)("div",{draggable:w,onDragStart:t=>{w&&(t.dataTransfer.effectAllowed="move",f({laneId:k,entryId:e.id}))},onDragOver:r=>{y&&y.laneId===k&&y.entryId!==e.id&&(r.preventDefault(),r.stopPropagation(),v(t))},onDrop:t=>{t.preventDefault(),t.stopPropagation(),y&&d&&y.laneId===k&&y.entryId!==e.id&&d(k,y.entryId,_),f(null),v(null)},onDragEnd:()=>{f(null),v(null)},className:"\n                    ".concat(g?"opacity-50":"","\n                    ").concat(x===t?"border-t-2 border-pink-nebula-accent-primary":"","\n                    ").concat(w?"cursor-move":"","\n                  "),children:(0,n.jsx)(F,{entry:e,currentTurn:o,onCancel:()=>l(k,e),onQuantityChange:u?t=>u(k,e,t):void 0,maxQuantity:b,showQuantityInput:h,disabled:p,isNewest:s,def:a,busyWorkers:i})},e.id)}):(0,n.jsx)("div",{className:"text-center text-pink-nebula-muted text-base py-8",children:"Queue empty"})}),(0,n.jsx)("div",{className:"mt-4 pt-2 border-t border-pink-nebula-border",children:(0,n.jsxs)("div",{className:"text-xs text-pink-nebula-muted text-center",children:["building"===k&&"Hover to cancel","ship"===k&&"Batch production","colonist"===k&&"Requires housing","research"===k&&"Research lane"]})})]})]})});function B(e){let{availableItems:t,onQueueItem:r,canQueueItem:a,activeTab:i,onTabChange:o,currentTurn:l=1}=e,[u,c]=(0,s.useState)("building"),d=null!=i?i:u,p=null!=o?o:c,m={building:[],ship:[],colonist:[],research:[]};Object.values(t).forEach(e=>{"outpost"!==e.id&&"worker"!==e.id&&e.lane&&m[e.lane]&&m[e.lane].push(e)}),Object.keys(m).forEach(e=>{m[e].sort((e,t)=>{let r=a(e.id,1).allowed,n=a(t.id,1).allowed;return r!==n?n?1:-1:e.durationTurns!==t.durationTurns?e.durationTurns-t.durationTurns:e.name.localeCompare(t.name)})});let h=e=>{switch(e){case"building":return{title:"Structures",icon:"\uD83C\uDFD7"};case"ship":return{title:"Ships",icon:"\uD83D\uDE80"};case"colonist":return{title:"Colonists",icon:"\uD83D\uDC65"};case"research":return{title:"Research",icon:"\uD83D\uDD2C"};default:return{title:"Unknown",icon:""}}},b=e=>a(e,1).allowed,_=e=>{switch(e){case"metal":return"text-gray-300";case"mineral":return"text-red-500";case"food":return"text-green-500";case"energy":return"text-blue-400";case"research_points":return"text-purple-400";case"workers":return"text-orange-400";case"ground_space":case"space":return"text-amber-600";case"orbital_space":return"text-blue-600";default:return"text-pink-nebula-muted"}},g=e=>e.toLocaleString("de-DE"),y=["metal","mineral","food","energy","research_points","workers","space"],[f,x]=(0,s.useState)({}),v=(e,t)=>{if(b(e)){if("building"===t||"research"===t)r(e,1);else{let t=parseInt(f[e]||"1")||1;a(e,t).allowed&&(r(e,t),x(t=>({...t,[e]:"1"})))}}},k=(e,t)=>{x(r=>({...r,[e]:t}))},w=(e,t)=>{if("Enter"===e.key){e.preventDefault();let n=parseInt(f[t]||"1")||1;a(t,n).allowed&&(r(t,n),x(e=>({...e,[t]:"1"})))}else"Escape"===e.key&&x(e=>({...e,[t]:"1"}))},N=m[d]||[],T=h(d);return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("div",{className:"flex gap-2 mb-4",children:["building","ship","colonist","research"].map(e=>{let t=h(e),r=d===e;return(0,n.jsxs)("button",{onClick:()=>p(e),className:"\n                px-4 py-2 rounded-t-lg font-semibold transition-all duration-[350ms]\n                ".concat(r?"bg-slate-800 text-pink-nebula-text border-b-2 border-pink-nebula-accent-primary":"bg-slate-700 text-pink-nebula-muted hover:bg-slate-750","\n              "),children:[(0,n.jsx)("span",{className:"mr-2",children:t.icon}),t.title]},e)})}),(0,n.jsxs)(P,{className:"p-4 h-[600px] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-pink-nebula-border",children:[(0,n.jsx)("span",{className:"text-xl",children:T.icon}),(0,n.jsx)("h3",{className:"text-lg font-bold text-pink-nebula-text",children:T.title}),(0,n.jsxs)("span",{className:"ml-auto text-sm text-pink-nebula-muted",children:[N.length," items"]})]}),(0,n.jsx)("div",{className:"space-y-2",children:0===N.length?(0,n.jsx)("div",{className:"text-center text-pink-nebula-muted text-base py-4",children:"No items available"}):N.map(e=>{var t;let r=b(e.id),s=e.costsPerUnit||{},a=(null===(t=e.upkeepPerUnit)||void 0===t?void 0:t.energy)||0;return(0,n.jsx)("div",{className:"\n                    w-full text-left p-2 bg-pink-nebula-panel/50 border border-pink-nebula-border rounded\n                    transition-colors group\n                    ".concat(r?"hover:bg-pink-nebula-panel/70":"opacity-50","\n                  "),children:(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm font-mono",children:[(0,n.jsx)("div",{className:"text-pink-nebula-text font-semibold whitespace-nowrap w-40 truncate",children:e.name}),y.map(e=>{let t=s[e]||0;return(0,n.jsx)("div",{className:"w-16 text-right ".concat(t>0?_(e):"text-transparent"),title:e,children:t>0?g(t):"-"},e)}),(0,n.jsx)("div",{className:"w-12 text-right ".concat(a>0?"text-blue-400":"text-transparent"),title:"Energy consumption per turn",children:a>0?"-".concat(g(a),""):"-"}),(0,n.jsx)("div",{className:"flex-1"}),("ship"===d||"colonist"===d)&&(0,n.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:f[e.id]||"1",onChange:t=>k(e.id,t.target.value),onKeyDown:t=>w(t,e.id),onClick:e=>e.stopPropagation(),disabled:!r,className:"\n                          w-14 px-2 py-0.5 bg-pink-nebula-bg border border-pink-nebula-border rounded\n                          text-pink-nebula-text text-sm text-center font-mono\n                          focus:outline-none focus:border-pink-nebula-accent-primary\n                          ".concat(r?"":"opacity-50 cursor-not-allowed","\n                        "),placeholder:"1"}),(0,n.jsxs)("div",{className:"text-pink-nebula-muted whitespace-nowrap w-8 text-right",children:[e.durationTurns,"T"]}),(0,n.jsx)("button",{onClick:()=>v(e.id,d),disabled:!r,className:"\n                        px-2 py-0.5 rounded text-sm\n                        ".concat(r?"bg-pink-nebula-accent-primary/80 hover:bg-pink-nebula-accent-primary text-white cursor-pointer":"bg-slate-700 text-slate-500 cursor-not-allowed","\n                      "),children:"+"})]})},e.id)})})]})]})}function G(e){let{warnings:t}=e;if(0===t.length)return null;let r=e=>{switch(e){case"error":return"bg-red-900/20 border-red-400 text-red-400";case"warning":return"bg-yellow-900/20 border-yellow-400 text-yellow-400";case"info":return"bg-blue-900/20 border-blue-400 text-blue-400";default:return"bg-pink-nebula-bg border-pink-nebula-border text-pink-nebula-muted"}},s=e=>{switch(e){case"error":return"\uD83D\uDEA8";case"warning":return"";case"info":return"";default:return""}};return(0,n.jsx)("div",{className:"space-y-2 w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-auto",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded border-l-4 ".concat(r(e.severity)),children:[(0,n.jsx)("div",{className:"text-lg",children:s(e.severity)}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("div",{className:"text-sm font-semibold",children:e.message})})]},t))})}function H(e){for(let t of["Extractor","Factory","Lab","Mine"])if(e.endsWith(" ".concat(t)))return e.substring(0,e.length-t.length-1).trim();let t={"Hydroponics Dome":"Hydro Dome"};return t[e]?t[e]:e}function W(e,t){let r=[];return e.forEach(e=>{e.entries.forEach(n=>{var s,a,i,o,l;let u;if(0===(u="completed"===n.status?null!==(s=n.completionTurn)&&void 0!==s?s:0:"active"===n.status?n.eta||0:"pending"===n.status?null!==(i=null!==(a=n.completionTurn)&&void 0!==a?a:n.eta)&&void 0!==i?i:0:null!==(l=null!==(o=n.completionTurn)&&void 0!==o?o:n.eta)&&void 0!==l?l:0)){console.warn("Queue item ".concat(n.itemName," has no valid completion turn"));return}void 0!==t&&u>t||r.push({turn:u,lane:e.laneId,name:n.itemName,quantity:n.quantity})})}),r.sort((e,t)=>e.turn-t.turn)}async function V(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Failed to copy to clipboard:",e),!1}}function Y(e){let{isOpen:t,onClose:r,buildingLane:a,shipLane:i,colonistLane:o,currentTurn:l,exportMode:u}=e,[c,d]=(0,s.useState)(null),p=[a,i,o],m="current"===u?l:void 0,h=e=>{d(e),setTimeout(()=>d(null),3e3)},b=async()=>{let e=function(e,t){let r=W(e,t);return 0===r.length?"":r.map(e=>{let t=H(e.name),r="building"===e.lane?t:"".concat(e.quantity,"x ").concat(t);return"[".concat(e.turn,"] - ").concat(r)}).join("\n")}(p,m);if(!e){h("Queue is empty - nothing to export");return}await V(e)?h(" Copied to clipboard!"):h(" Failed to copy to clipboard")},_=async()=>{let e=function(e,t){let r=W(e,t),n=new Map;r.forEach(e=>{n.has(e.turn)||n.set(e.turn,[]),n.get(e.turn).push(e)});let s="```\n";s+="| Turn | Structure       | Ship            | Colonist        |\n|------|-----------------|-----------------|-----------------|";let a=!1;return Array.from(n.entries()).sort((e,t)=>{let[r]=e,[n]=t;return r-n}).forEach(e=>{let[t,r]=e,n=r.find(e=>"building"===e.lane),i=r.find(e=>"ship"===e.lane),o=r.find(e=>"colonist"===e.lane),l=n?H(n.name):"",u=i?"".concat(i.quantity,"x ").concat(H(i.name)):"",c=o?"".concat(o.quantity,"x ").concat(H(o.name)):"",d="\n| ".concat(String(t).padEnd(4)," | ").concat(l.padEnd(15)," | ").concat(u.padEnd(15)," | ").concat(c.padEnd(15)," |");s.length+d.length+4>8192&&(a=!0),s+=d}),s+="\n```",a?"Buildlist exceeds character limit on Discord\n\n"+s:s}(p,m);await V(e)?e.includes("exceeds character limit")?h(" Copied with warning - may exceed Discord limit"):h(" Copied to clipboard!"):h(" Failed to copy to clipboard")},g=async()=>{try{let e=W(p,m);if(0===e.length){h("Queue is empty - nothing to export");return}let t=new Map;e.forEach(e=>{t.has(e.turn)||t.set(e.turn,[]),t.get(e.turn).push(e)});let r=Array.from(t.keys()).sort((e,t)=>e-t),n=document.createElement("canvas"),s=n.getContext("2d"),a=60+28*r.length+40+80;n.width=500,n.height=a,s.fillStyle="#1a1625",s.fillRect(0,0,500,a),s.fillStyle="#e0d4f7",s.font="bold 24px sans-serif",s.fillText("Build Order",40,64),s.fillStyle="#9d8ec2",s.font="14px sans-serif",s.fillText("Turn ".concat(l),40,88);let i=100;s.font="16px monospace",r.forEach(e=>{let r=t.get(e),n=[],a=r.find(e=>"building"===e.lane),o=r.find(e=>"ship"===e.lane),l=r.find(e=>"colonist"===e.lane);a&&n.push(a.name),o&&n.push("".concat(o.quantity,"x ").concat(o.name)),l&&n.push("".concat(l.quantity,"x ").concat(l.name));let u="[".concat(String(e).padStart(3),"] ").concat(n.join(", "));s.fillStyle="#c4b5e0",s.fillText(u,40,i),i+=28}),s.fillStyle="#6b5a8e",s.font="italic 12px sans-serif",s.fillText("Infinite Conflict Build Planner",40,a-20),n.toBlob(e=>{if(!e){h(" Failed to generate image");return}let t=URL.createObjectURL(e),r=document.createElement("a");r.download="build-order-turn-".concat(l,".png"),r.href=t,r.click(),URL.revokeObjectURL(t),h(" Image downloaded!")},"image/png")}catch(e){console.error("Image export error:",e),h(" Failed to export image")}};return t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:r}),(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:(0,n.jsxs)("div",{className:"bg-slate-800 border-2 border-pink-nebula-border rounded-lg p-6 max-w-md w-full pointer-events-auto shadow-2xl",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-pink-nebula-text mb-4",children:"Export Build Queue"}),(0,n.jsxs)("div",{className:"text-sm text-pink-nebula-muted mb-4",children:["Current Turn: ",l]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("button",{onClick:b,className:"w-full p-3 bg-slate-700 hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded text-left transition-colors",children:[(0,n.jsx)("div",{className:"font-semibold text-pink-nebula-text",children:"Export as Plain Text"}),(0,n.jsx)("div",{className:"text-xs text-pink-nebula-muted mt-1",children:"Simple list format - copied to clipboard"})]}),(0,n.jsxs)("button",{onClick:_,className:"w-full p-3 bg-slate-700 hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded text-left transition-colors",children:[(0,n.jsx)("div",{className:"font-semibold text-pink-nebula-text",children:"Export for Discord"}),(0,n.jsx)("div",{className:"text-xs text-pink-nebula-muted mt-1",children:"Formatted table (8,192 char limit) - copied to clipboard"})]}),(0,n.jsxs)("button",{onClick:g,className:"w-full p-3 bg-slate-700 hover:bg-pink-nebula-accent-primary/20 border border-pink-nebula-border rounded text-left transition-colors",children:[(0,n.jsx)("div",{className:"font-semibold text-pink-nebula-text",children:"Export as Image"}),(0,n.jsx)("div",{className:"text-xs text-pink-nebula-muted mt-1",children:"PNG file - captures Planet Queue display"})]})]}),c&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-pink-nebula-accent-primary/20 border border-pink-nebula-accent-primary rounded text-sm text-pink-nebula-text text-center animate-fade-in",children:c}),(0,n.jsx)("button",{onClick:r,className:"mt-4 w-full py-2 text-pink-nebula-muted hover:text-pink-nebula-text transition-colors",children:"Cancel"})]})})]}):null}function K(e){let{planets:t,currentPlanetId:r,onPlanetSwitch:s,onAddPlanet:a,maxPlanets:i}=e,o=Array.from(t.values()),l=t.size<i,u=e=>{let t=["\uD83C\uDF0D","\uD83D\uDD34","\uD83C\uDF19","\uD83E\uDE90"];return t[e%t.length]};return(0,n.jsxs)("div",{className:"flex gap-2 mb-4 p-2 bg-pink-nebula-panel/50 rounded-lg border border-pink-nebula-border",children:[o.map((e,t)=>{let a=e.id===r;return(0,n.jsxs)("button",{onClick:()=>s(e.id),className:"\n              px-4 py-2 rounded-lg font-semibold transition-all duration-200\n              flex items-center gap-2\n              ".concat(a?"bg-pink-nebula-accent-primary text-white shadow-lg scale-105":"bg-slate-700 text-pink-nebula-text hover:bg-slate-600 hover:scale-102","\n            "),children:[(0,n.jsx)("span",{className:"text-xl",children:u(t)}),(0,n.jsxs)("div",{className:"flex flex-col items-start",children:[(0,n.jsx)("span",{className:"text-sm",children:e.name}),(0,n.jsxs)("span",{className:"text-xs opacity-70",children:["Turn ",e.currentTurn]})]})]},e.id)}),l&&(0,n.jsxs)("button",{onClick:a,className:"   px-4 py-2 rounded-lg font-semibold transition-all duration-200   bg-slate-700 text-pink-nebula-text hover:bg-slate-600   border-2 border-dashed border-pink-nebula-border   flex items-center gap-2 hover:scale-102   ",children:[(0,n.jsx)("span",{className:"text-xl",children:""}),(0,n.jsx)("span",{className:"text-sm",children:"Add Planet"})]}),!l&&(0,n.jsx)("div",{className:"   px-4 py-2 rounded-lg   bg-slate-800 text-pink-nebula-muted   border-2 border-dashed border-pink-nebula-border/30   flex items-center gap-2 opacity-50   ",children:(0,n.jsxs)("span",{className:"text-sm",children:["Max Planets (",i,"/",i,")"]})})]})}let X={MIN:50,MAX:200,DEFAULT:100},z={HOMEWORLD:{abundance:{metal:100,mineral:100,food:100,energy:100,research_points:100},space:{groundCap:60,orbitalCap:40}},HOME_GALAXY:{abundance:{metal:60,mineral:60,food:60,energy:60,research_points:60},space:{groundCap:60,orbitalCap:40}},FREE_GALAXY:{abundance:{metal:80,mineral:80,food:80,energy:80,research_points:80},space:{groundCap:75,orbitalCap:55}}},J={WORKERS:5e3,METAL:6e3,MINERAL:4e3,FOOD:2e3,ENERGY:0,BUILDINGS:["Outpost"]},Z={metal:"text-gray-300",mineral:"text-red-400",food:"text-green-400",energy:"text-blue-400",research_points:"text-purple-400"};function $(e){return Math.max(X.MIN,Math.min(X.MAX,Math.round(e)||X.DEFAULT))}function ee(e){let{isOpen:t,onClose:r,onAddPlanet:a,currentTurn:i}=e,[o,l]=(0,s.useState)("Colony"),[u,c]=(0,s.useState)(i),[d,p]=(0,s.useState)({...z.HOMEWORLD.abundance}),[m,h]=(0,s.useState)({...z.HOMEWORLD.space}),[b,_]=(0,s.useState)(!1),[g,y]=(0,s.useState)(""),f=(0,s.useCallback)(()=>{a({name:o,startTurn:u,abundance:Object.fromEntries(Object.entries(Object.fromEntries(Object.entries(d).map(e=>{let[t,r]=e;return[t,$(r)]}))).map(e=>{let[t,r]=e;return[t,r/100]})),space:m}),r()},[o,u,d,m,a,r]),x=(0,s.useCallback)((e,t)=>{p(r=>({...r,[e]:t}))},[]),v=(0,s.useCallback)((e,t)=>{p(r=>({...r,[e]:$(t)}))},[]),k=(0,s.useCallback)(e=>{let t=z[e.toUpperCase().replace("-","_")];t&&(p({...t.abundance}),h({...t.space}))},[]),w=(0,s.useCallback)(e=>{let t={groundCap:60,orbitalCap:40,abundance:{...z.HOMEWORLD.abundance}},r=e.match(/Ground\s+Space\s*\n?\s*(\d+)/i);r&&(t.groundCap=parseInt(r[1]));let n=e.match(/Orbital\s+Space\s*\n?\s*(\d+)/i);n&&(t.orbitalCap=parseInt(n[1]));let s=e.match(/Metal[\s\S]*?(\d+)%/i);s&&(t.abundance.metal=parseInt(s[1]));let a=e.match(/Mineral[\s\S]*?(\d+)%/i);a&&(t.abundance.mineral=parseInt(a[1]));let i=e.match(/Food[\s\S]*?(\d+)%/i);i&&(t.abundance.food=parseInt(i[1]));let o=e.match(/Energy[\s\S]*?(\d+)%/i);return o&&(t.abundance.energy=parseInt(o[1])),t},[]),N=(0,s.useCallback)(()=>{let e=w(g);p(e.abundance),h({groundCap:e.groundCap,orbitalCap:e.orbitalCap}),_(!1),y("")},[g,w]);return t?(0,n.jsxs)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:[(0,n.jsxs)("div",{className:"bg-pink-nebula-panel border-2 border-pink-nebula-border rounded-lg p-6 max-w-2xl w-full mx-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-pink-nebula-accent-primary mb-6",children:"Add New Planet"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-pink-nebula-text mb-3",children:"Basic Settings"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-pink-nebula-text-secondary mb-1",children:"Planet Name"}),(0,n.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none",placeholder:"Enter planet name"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-pink-nebula-text-secondary mb-1",children:"Start Turn"}),(0,n.jsx)("input",{type:"number",value:u,onChange:e=>c(Math.max(1,parseInt(e.target.value)||1)),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none",min:"1"})]})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-pink-nebula-text",children:"Resource Abundances"}),(0,n.jsx)("p",{className:"text-sm text-pink-nebula-text-secondary",children:"Percentages affect production rates (50% - 200%)"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>k("home-galaxy"),className:"px-3 py-1 text-xs bg-slate-700 text-pink-nebula-text rounded hover:bg-slate-600 transition-colors",children:"Home Galaxy Avg (60%)"}),(0,n.jsx)("button",{type:"button",onClick:()=>k("free-galaxy"),className:"px-3 py-1 text-xs bg-slate-700 text-pink-nebula-text rounded hover:bg-slate-600 transition-colors",children:"Free Galaxy Avg (80%)"}),(0,n.jsx)("button",{type:"button",onClick:()=>k("homeworld"),className:"px-3 py-1 text-xs bg-pink-nebula-accent-primary text-white rounded hover:bg-pink-500 transition-colors",children:"Homeworld (100%)"}),(0,n.jsx)("button",{type:"button",onClick:()=>_(!0),className:"px-3 py-1 text-xs bg-slate-700 text-pink-nebula-text rounded hover:bg-slate-600 transition-colors",children:"Import Data"})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(d).filter(e=>{let[t]=e;return"research_points"!==t}).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("label",{className:"w-24 text-sm capitalize ".concat(Z[t]||"text-pink-nebula-text"),children:[t.replace("_"," "),":"]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("input",{type:"number",value:r,onChange:e=>x(t,parseFloat(e.target.value)),onBlur:e=>v(t,parseFloat(e.target.value)),onFocus:e=>e.target.select(),className:"w-16 px-2 py-1 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none text-right",min:X.MIN,max:X.MAX,step:"1"}),(0,n.jsx)("span",{className:"text-sm text-pink-nebula-text",children:"%"})]}),(0,n.jsx)("span",{className:"text-xs text-pink-nebula-text-secondary",children:r<100?"(scarce)":r>100?"(rich)":"(normal)"})]},t)})})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-pink-nebula-text mb-3",children:"Space Budgets"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-amber-700 mb-1",children:"Ground Space Capacity"}),(0,n.jsx)("input",{type:"number",value:m.groundCap,onChange:e=>h(t=>({...t,groundCap:Math.max(10,parseInt(e.target.value)||25)})),className:"w-full px-3 py-2 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none",min:"10",max:"100"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-blue-800 mb-1",children:"Orbital Space Capacity"}),(0,n.jsx)("input",{type:"number",value:m.orbitalCap,onChange:e=>h(t=>({...t,orbitalCap:Math.max(5,parseInt(e.target.value)||15)})),className:"w-full px-3 py-2 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none",min:"5",max:"50"})]})]})]}),(0,n.jsxs)("div",{className:"mb-6 p-3 bg-slate-800 rounded border border-pink-nebula-border",children:[(0,n.jsxs)("p",{className:"text-sm text-pink-nebula-text-secondary",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Starter Package:"})," ",J.WORKERS.toLocaleString()," workers, ",J.METAL.toLocaleString()," metal, ",J.MINERAL.toLocaleString()," mineral, ",J.FOOD.toLocaleString()," food, ",J.ENERGY," energy"]}),(0,n.jsxs)("p",{className:"text-sm text-pink-nebula-text-secondary mt-1",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Starter Buildings:"})," ",J.BUILDINGS.join(", ")]})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,n.jsx)("button",{onClick:r,className:"px-6 py-2 bg-slate-700 text-pink-nebula-text rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),(0,n.jsx)("button",{onClick:f,className:"px-6 py-2 bg-pink-nebula-accent-primary text-white rounded-lg hover:bg-pink-500 transition-colors",children:"Add Planet"})]})]}),b&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-10",children:(0,n.jsxs)("div",{className:"bg-pink-nebula-panel border-2 border-pink-nebula-border rounded-lg p-6 max-w-3xl w-full mx-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-pink-nebula-accent-primary mb-4",children:"Import Planet Data"}),(0,n.jsx)("p",{className:"text-sm text-pink-nebula-text-secondary mb-3",children:"Paste planet data from your game. The import will extract:"}),(0,n.jsxs)("ul",{className:"text-sm text-pink-nebula-text-secondary mb-4 list-disc list-inside",children:[(0,n.jsx)("li",{children:"Ground Space and Orbital Space"}),(0,n.jsx)("li",{children:"Resource abundance percentages (Metal, Mineral, Food, Energy)"})]}),(0,n.jsx)("textarea",{value:g,onChange:e=>y(e.target.value),placeholder:"Paste planet data here...",className:"w-full h-64 px-3 py-2 bg-slate-800 text-pink-nebula-text rounded border border-pink-nebula-border focus:border-pink-nebula-accent-primary outline-none font-mono text-sm",autoFocus:!0}),(0,n.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,n.jsx)("button",{onClick:()=>{_(!1),y("")},className:"px-6 py-2 bg-slate-700 text-pink-nebula-text rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"}),(0,n.jsx)("button",{onClick:N,className:"px-6 py-2 bg-pink-nebula-accent-primary text-white rounded-lg hover:bg-pink-500 transition-colors",children:"Import"})]})]})})]}):null}function et(){(0,s.useEffect)(()=>{_(!1),window.gameLogger={enable:()=>{g().setEnabled(!0),console.log("[Logger] Logging enabled. Operations will be logged to browser localStorage."),console.log("[Logger] Use gameLogger.export() to download logs or gameLogger.clear() to remove them.")},disable:()=>{g().setEnabled(!1),console.log("[Logger] Logging disabled.")},flush:async()=>{await g().flush(),console.log("[Logger] Logs flushed to storage.")},export:()=>{let e=g().exportLogsFromBrowser();e.forEach(e=>{let{filename:t,content:r}=e,n=new Blob([r],{type:"text/csv"}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=t,a.click(),URL.revokeObjectURL(s)}),console.log("[Logger] Exported ".concat(e.length," log files."))},clear:()=>{g().clearLogsFromBrowser(),console.log("[Logger] Logs cleared from localStorage.")},status:()=>{let e=g();console.log("[Logger] Status:",{enabled:e.isEnabled(),logs:e.exportLogsFromBrowser().length})},help:()=>{console.log("\nGame Logger Commands:\n---------------------\ngameLogger.enable()   - Enable logging (logs to browser localStorage)\ngameLogger.disable()  - Disable logging\ngameLogger.flush()    - Force flush logs to storage\ngameLogger.export()   - Download all logs as CSV files\ngameLogger.clear()    - Clear all logs from localStorage\ngameLogger.status()   - Show logging status\ngameLogger.help()     - Show this help message\n\nLogged Data:\n-----------\n1. queue_operations.csv - All queue operations (queue, cancel, reorder, activate, complete)\n2. planet_states.csv    - State snapshots (resources, population, lane status)\n3. timeline_events.csv  - Timeline events (mutations, recompute, stable state, advance)\n\nUsage Example:\n-------------\n> gameLogger.enable()\n> // Play the game, queue items, advance turns\n> gameLogger.export()    // Download logs\n> gameLogger.clear()     // Clean up localStorage\n        ")}},console.log('[Logger] Game logging utilities loaded. Type "gameLogger.help()" for usage.')},[]);let[e]=(0,s.useState)(()=>new U),[t,r]=(0,s.useState)(!1),[a,i]=(0,s.useState)(()=>{let e=function(){let e=window.location.hash;return e&&e.startsWith("#state=")?function(e){try{let t=S().decompressFromEncodedURIComponent(e);if(!t)return console.error("Failed to decompress game state"),null;let r=JSON.parse(t);if(1!==r.v)return console.warn("State version mismatch: ".concat(r.v," !== ").concat(1)),null;return r}catch(e){return console.error("Failed to decode game state:",e),null}}(e.substring(7)):null}();return e&&console.log("[URL State] Loading from URL:",{planets:e.planets.length,commands:e.cmds.length}),function(){let e=w(I,{stocks:{metal:3e4,mineral:2e4,food:1e3,energy:0},abundance:{metal:1,mineral:1,food:1,energy:1},population:{workersTotal:2e4,soldiers:0,scientists:0},structures:{outpost:1,metal_mine:3,mineral_extractor:3,farm:1,solar_generator:1},space:{groundCap:60,orbitalCap:40}});e.id="planet-1",e.name="Homeworld",e.startTurn=1,e.timeline=new v(e);let t=new Map;return t.set("planet-1",e),{planets:t,currentPlanetId:"planet-1",globalResearch:{queue:[],completed:[]},nextPlanetId:2,maxPlanets:4}}()}),[o,l]=(0,s.useState)(!1),[p,h]=(0,s.useState)(1),[b,y]=(0,s.useState)(null),[x,q]=(0,s.useState)(new Map),[E,L]=(0,s.useState)(null),[M,D]=(0,s.useState)("building"),F=a.currentPlanetId,H=(0,s.useMemo)(()=>a.planets.get(F)||null,[a.planets,F]),W=(0,s.useMemo)(()=>H&&H.timeline?new k(H,H.timeline):null,[F]);(0,s.useEffect)(()=>{let t=setTimeout(()=>{try{let t=Array.from(a.planets.values()).map(e=>{var t,r,n,s,a,i,o;return{name:e.name,startTurn:e.startTurn,abundance:{metal:(null===(t=e.abundance)||void 0===t?void 0:t.metal)||1,mineral:(null===(r=e.abundance)||void 0===r?void 0:r.mineral)||1,food:(null===(n=e.abundance)||void 0===n?void 0:n.food)||1,energy:(null===(s=e.abundance)||void 0===s?void 0:s.energy)||1,research_points:(null===(a=e.abundance)||void 0===a?void 0:a.research_points)||1},space:{groundCap:(null===(i=e.space)||void 0===i?void 0:i.groundCap)||60,orbitalCap:(null===(o=e.space)||void 0===o?void 0:o.orbitalCap)||40}}}),r=e.getCommands();if(r.length>0){!function(e,t){let r=R(e,t);window.location.hash="state=".concat(r)}(t,r);let e=function(e,t){let r=R(e,t);return{json:JSON.stringify({v:1,planets:e,cmds:t}).length,encoded:r.length,chars:r.length}}(t,r);console.log("[URL State] Saved:",{planets:t.length,commands:r.length,urlLength:window.location.href.length,jsonSize:e.json,compressedSize:e.encoded})}}catch(e){console.error("[URL State] Failed to save:",e)}},1e3);return()=>clearTimeout(t)},[a,e]);let V=null==W?void 0:W.getStateAtTurn(p),X=(null==W?void 0:W.getTotalTurns())||200,z=(null==V?void 0:V.defs)||N(T),J=(0,s.useCallback)(e=>e.map(e=>{let t=x.get(e.id);return t?{...e,invalid:!t.valid,invalidReason:t.reason?function(e){if(e.valid)return"";let t=e.reason||"UNKNOWN";if(t.startsWith("REQ_MISSING:")){var r;let e=(null===(r=t.split(":")[1])||void 0===r?void 0:r.trim())||"unknown";return"Missing prerequisite: ".concat(e)}if(t.startsWith("INSUFFICIENT_HOUSING:"))return t.replace("INSUFFICIENT_HOUSING:","Not enough housing:");switch(t){case"HOUSING_MISSING":return"Insufficient housing capacity";case"ENERGY_INSUFFICIENT":return"Not enough energy";case"REQ_MISSING":return"Missing prerequisites";default:return t}}(t):void 0,missingPrereqs:t.missingPrereqs}:e}),[x]),Z=(0,s.useMemo)(()=>V?function(e){let t=u(e),r=f(e),n=e.stocks.food>0?Math.floor(e.population.workersTotal*(.01+r)):0,s=Object.values(e.population.busyByLane).reduce((e,t)=>e+(t||0),0),a=c(e),i={};Object.entries(e.completedCounts).forEach(t=>{let[r,n]=t,s=e.defs[r];s&&"ship"===s.type&&n>0&&(i[r]=n)});let o={};return Object.entries(e.completedCounts).forEach(t=>{let[r,n]=t,s=e.defs[r];s&&"structure"===s.type&&n>0&&(o[r]=n)}),{turn:e.currentTurn,stocks:{...e.stocks},abundance:{...e.abundance},outputsPerTurn:t,space:{...e.space},housing:{...e.housing},population:{workersTotal:e.population.workersTotal,workersIdle:e.population.workersIdle,workersBusy:s,soldiers:e.population.soldiers,scientists:e.population.scientists},ships:i,structures:o,growthHint:n>0?"+".concat(n," workers at end of turn"):"No growth (need food > 0)",foodUpkeep:a,planetLimit:e.planetLimit||4,completedResearch:e.completedResearch||[]}}(V):null,[V]),$=(0,s.useMemo)(()=>V?C(V,"building"):null,[V]),et=(0,s.useMemo)(()=>V?C(V,"ship"):null,[V]),er=(0,s.useMemo)(()=>V?C(V,"colonist"):null,[V]),en=(0,s.useMemo)(()=>V?C(V,"research"):null,[V]),es=(0,s.useMemo)(()=>V?function(e){let t=[];return e.stocks.energy<0&&t.push({type:"NEGATIVE_ENERGY",message:"Energy is negative! Production will be affected.",severity:"error"}),e.stocks.food<=0&&t.push({type:"NO_FOOD",message:"No food available. Worker growth is halted.",severity:"warning"}),e.population.workersTotal/e.housing.workerCap>=.95&&t.push({type:"HOUSING_FULL",message:"Worker housing near capacity. Build more housing.",severity:"warning"}),e.population.soldiers/e.housing.soldierCap>=.95&&e.housing.soldierCap>0&&t.push({type:"HOUSING_FULL",message:"Soldier housing near capacity.",severity:"warning"}),e.population.scientists/e.housing.scientistCap>=.95&&e.housing.scientistCap>0&&t.push({type:"HOUSING_FULL",message:"Scientist housing near capacity.",severity:"warning"}),e.space.groundUsed/e.space.groundCap>=.95&&t.push({type:"SPACE_FULL",message:"Ground space near capacity.",severity:"warning"}),e.space.orbitalUsed/e.space.orbitalCap>=.95&&t.push({type:"SPACE_FULL",message:"Orbital space near capacity.",severity:"warning"}),t}(V):[],[V]),{building:ea,ship:ei,colonist:eo,research:el}=(0,s.useMemo)(()=>({building:$?{...$,entries:J($.entries)}:null,ship:et?{...et,entries:J(et.entries)}:null,colonist:er?{...er,entries:J(er.entries)}:null,research:en?{...en,entries:J(en.entries)}:null}),[$,et,er,en,J]),eu=(0,s.useMemo)(()=>{let e={};return Object.entries(z).forEach(t=>{let[r,n]=t;e[r]=n}),e},[z]),ec=(0,s.useCallback)((e,t)=>{if(!e)return{allowed:!1,reason:"No item selected"};if(!z[e])return{allowed:!1,reason:"Unknown item"};if(!W)return{allowed:!1,reason:"No controller available"};let r=W.getStateAtTurn(p);return r?function(e,t,r){let n=e.defs[t];if(!n)return{allowed:!1,reason:"Item not found"};let s=e.lanes[n.lane];return s.active?{allowed:!1,reason:"Lane is busy"}:s.pendingQueue.length>=s.maxQueueDepth?{allowed:!1,reason:"Queue is full"}:d(e,n,r)}(r,e,t):{allowed:!1,reason:"Invalid turn"}},[z,p,W]);if(!V||!Z||!ea||!ei||!eo||!el)return(0,n.jsx)("div",{className:"min-h-screen bg-pink-nebula-bg text-pink-nebula-text p-6",children:(0,n.jsxs)("h1",{className:"text-2xl font-bold",children:["Error: Invalid turn ",p]})});let ed=(0,s.useCallback)(e=>{let t=a.planets.get(e);t&&h(t.currentTurn),i(t=>j(t,e))},[a.planets]),ep=(0,s.useCallback)(()=>{a.planets.size<a.maxPlanets&&l(!0)},[a.planets.size,a.maxPlanets]),em=(0,s.useCallback)(e=>{try{let t=function(e,t){if(e.planets.size>=e.maxPlanets)throw Error("Maximum planet limit reached");let r="planet-".concat(e.nextPlanetId),n=w(I,{stocks:{metal:6e3,mineral:4e3,food:2e3,energy:0},abundance:t.abundance,population:{workersTotal:5e3,soldiers:0,scientists:0},space:{groundCap:t.space.groundCap,orbitalCap:t.space.orbitalCap},structures:{outpost:1}});n.id=r,n.name=t.name,n.startTurn=t.startTurn,n.currentTurn=t.startTurn,n.timeline=new v(n);let s=new Map(e.planets);return s.set(r,n),{...e,planets:s,nextPlanetId:e.nextPlanetId+1}}(a,e),r="planet-".concat(t.nextPlanetId-1);h(e.startTurn),i(j(t,r))}catch(e){y(e.message||"Failed to create planet")}},[a]),eh=(0,s.useCallback)((t,r)=>{if(y(null),!H||!W){y("No planet selected");return}try{let n=z[t];if(n&&"research"===n.lane){let r=function(e,t){var r,n;let s=!1,a=0;for(let t of Array.from(e.planets.values()))t.completedCounts.lab>0&&t.population.scientists>0&&(s=!0),a+=t.population.scientists||0;if(!s)throw Error("No planet has lab and scientists for research");if(0===a)throw Error("No scientists available to generate research points");let i=null===(r=e.planets.values().next().value)||void 0===r?void 0:r.defs[t];if(!i)throw Error("Research ".concat(t," not found"));let o=(null===(n=i.costsPerUnit)||void 0===n?void 0:n.research_points)||0,l=e.planets.get(e.currentPlanetId),u=(null==l?void 0:l.currentTurn)||1,c=function(e,t,r){let n=0,s=0;for(let t of Array.from(e.planets.values()))n+=t.stocks.research_points||0,s+=t.population.scientists||0;if(n>=t)return r;if(0===s)throw Error("No scientists available to generate research points");return r+Math.ceil((t-n)/s)}(e,o,u),d=o,p=Array.from(e.planets.values()).sort((e,t)=>(t.stocks.research_points||0)-(e.stocks.research_points||0)),h=new Map(e.planets);for(let e of p){if(d<=0)break;let t=e.stocks.research_points||0,r=Math.min(t,d),n={...e};n.stocks.research_points=t-r,h.set(e.id,n),d-=r}let b={id:m(),itemId:t,status:"pending",quantity:1,turnsRemaining:i.durationTurns,queuedTurn:c};return c>u&&g().logQueueOperation(u,"queue","research",t,i.name,1,"Scheduled for turn ".concat(c," (waiting for ").concat(o-d," RP, ").concat(a," scientists producing ").concat(a," RP/turn)")),{...e,planets:h,globalResearch:{...e.globalResearch,queue:[...e.globalResearch.queue,b]}}}(a,t);i(r),e.recordQueueResearch(t);return}let s=W.queueItem(p,t,r);if(!s.success){y(s.reason||"Cannot queue item");return}let o=Array.from(a.planets.keys()).indexOf(F);e.recordQueue(o,p,t,r);let l=W.getStateAtTurn(p);if(l&&i(e=>{let t=new Map(e.planets);return t.set(a.currentPlanetId,l),{...e,planets:t}}),n&&"building"===n.lane){let e=W.getStateAtTurn(p);if(e){let t=e.lanes[n.lane],r=0;for(let e of(t.active&&(r+=t.active.turnsRemaining),t.pendingQueue)){let t=z[e.itemId];t&&(r+=t.durationTurns)}let s=Math.min(p+r,199);h(s)}}}catch(e){console.error("Error in handleQueueItem:",e),y(e.message||"Unknown error")}},[H,W,z,p,a]),eb=(0,s.useCallback)((e,t)=>{if(y(null),!W){y("No planet selected");return}try{let r=t.queuedTurn||p,n=W.cancelEntryByIdSmart(r,e,t.id);if(!n.success){"NOT_FOUND"===n.reason?y("Item cannot be canceled (may be completed)"):y(n.reason||"Cannot cancel item");return}let s=W.getStateAtTurn(p);if(s){i(e=>{let t=new Map(e.planets);return t.set(a.currentPlanetId,s),{...e,planets:t}});let e=function(e,t){let r=[];for(let n of["building","ship","colonist"])for(let s of t(e,n)){if("completed"===s.status)continue;let t=function(e,t,r){let n=e.defs[t.itemId];if(!n)return{valid:!1,reason:"UNKNOWN_ITEM"};if(t.startTurn||e.currentTurn,n.prerequisites&&n.prerequisites.length>0){let r=[];for(let s of n.prerequisites){let n=(e.completedCounts[s]||0)>0;if(!n&&t.startTurn){let r=e.defs[s];if(r){let a=e.lanes[r.lane];if(a.active&&a.active.itemId===s){let e=a.active.completionTurn;e&&e<t.startTurn&&(n=!0)}for(let r of a.pendingQueue)if(r.itemId===s){let s=e.defs[r.itemId];if(s){let i=e.currentTurn;a.active&&(i+=a.active.turnsRemaining);let o=a.pendingQueue.indexOf(r);for(let t=0;t<o;t++){let r=e.defs[a.pendingQueue[t].itemId];r&&(i+=r.durationTurns)}if((i+=s.durationTurns)<t.startTurn){n=!0;break}}}}}n||r.push(s)}if(r.length>0)return{valid:!1,reason:"REQ_MISSING: ".concat(r[0]),missingPrereqs:r}}let s=d(e,n,t.quantity);return s.allowed?{valid:!0}:{valid:!1,reason:s.reason}}(e,s,0);r.push({entryId:s.id,laneId:n,...t})}return r}(s,(e,t)=>C(e,t).entries),t=new Map;for(let r of e)t.set(r.entryId,r);q(t)}}catch(e){y(e.message||"Unknown error")}},[W,p,a]),e_=(0,s.useCallback)((e,t,r)=>{if(y(null),!W){y("No planet selected");return}try{let n=t.queuedTurn||p;if(!W.cancelEntryByIdSmart(n,e,t.id).success){y("Failed to update quantity");return}let s=W.queueItem(p,t.itemId,r);s.success||(y("Cannot set quantity to ".concat(r,": ").concat(s.reason||"validation failed")),W.queueItem(p,t.itemId,t.quantity));let o=W.getStateAtTurn(p);o&&i(e=>{let t=new Map(e.planets);return t.set(a.currentPlanetId,o),{...e,planets:t}})}catch(e){y(e.message||"Unknown error")}},[W,p,a]),eg=(0,s.useCallback)((e,t,r)=>{if(y(null),!W){y("No planet selected");return}try{let n=W.reorderQueueItem(p,e,t,r);if(!n.success){y("Cannot reorder: ".concat(n.reason||"unknown error"));return}let s=W.getStateAtTurn(p);s&&i(e=>{let t=new Map(e.planets);return t.set(a.currentPlanetId,s),{...e,planets:t}})}catch(e){console.error("Error reordering item:",e),y(e.message||"Unknown error")}},[W,p,a]),ey=(0,s.useCallback)((e,t)=>{if(!W)return t.quantity;let r=W.getStateAtTurn(p);if(!r||!r.defs[t.itemId])return t.quantity;let n=1,s=1e4,a=t.quantity;for(;n<=s;){let e=Math.floor((n+s)/2);ec(t.itemId,e).allowed?(a=e,n=e+1):s=e-1}return a},[W,p,ec]);return(0,s.useCallback)(()=>{if(y(null),!W||!H){y("No planet selected");return}try{W.nextTurn(),h(W.getTotalTurns()-1);let e=W.getStateAtTurn(p);e&&i(t=>{let r=new Map(t.planets),n=r.get(a.currentPlanetId);return n&&(n.currentTurn=W.getTotalTurns()-1),r.set(a.currentPlanetId,e),{...t,planets:r}})}catch(e){y(e.message||"Unknown error")}},[W,H,p,a]),(0,n.jsxs)("div",{className:"min-h-screen bg-pink-nebula-bg text-pink-nebula-text font-sans flex flex-col relative",children:[(0,n.jsx)("div",{className:"fixed inset-0 z-0 bg-cover bg-no-repeat pointer-events-none",style:{backgroundImage:"url(/BG_Nebula.png)",backgroundPosition:"33% center",opacity:.2}}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 relative z-10",children:[(0,n.jsx)("header",{className:"bg-pink-nebula-panel px-6 py-4 border-b border-pink-nebula-border",children:(0,n.jsx)("h1",{className:"text-2xl font-bold tracking-wide",children:"Infinite Conflict Simulator"})}),(0,n.jsx)("div",{className:"px-6 py-2",children:(0,n.jsx)(K,{planets:a.planets,currentPlanetId:a.currentPlanetId,onPlanetSwitch:ed,onAddPlanet:ep,maxPlanets:a.maxPlanets})}),b&&(0,n.jsx)("div",{className:"mx-auto mt-4 w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl px-6 bg-red-900/20 border border-red-400 rounded p-4 text-red-400",children:b}),es.length>0&&(0,n.jsx)("div",{className:"px-6 mt-4",children:(0,n.jsx)(G,{warnings:es})}),(0,n.jsx)(A,{summary:Z,defs:z,turnsToHousingCap:V?function(e,t){let{workersTotal:r}=e.population,{workerCap:n}=e.housing;if(r>=n||0===r)return null;let s=f(e),a=e.stocks.food>0?Math.floor(r*(.01+s)):0;if(a<=0||!isFinite(a))return null;let i=Math.ceil((n-r)/a);return!isFinite(i)||i<=0?null:i}(V,0):null}),(0,n.jsx)("div",{className:"w-full max-w-[1800px] mx-auto px-6",children:(0,n.jsx)(O,{currentTurn:p,totalTurns:X,onTurnChange:h})}),(0,n.jsx)("main",{className:"flex-1 max-w-[1800px] mx-auto w-full px-6 py-6",children:(0,n.jsxs)("div",{className:"flex gap-6",children:[(0,n.jsxs)(P,{className:"flex-1 p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-pink-nebula-text mb-6",children:"Add to Queue"}),(0,n.jsx)(B,{availableItems:eu,onQueueItem:eh,canQueueItem:ec,activeTab:M,onTabChange:D})]}),(0,n.jsxs)(P,{className:"flex-1 p-6","data-export-target":"planet-queue",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-pink-nebula-text",children:"Planet Queue"}),e.getCommands().length>0&&(0,n.jsx)("div",{className:"text-sm text-pink-nebula-text-secondary",children:(0,n.jsxs)("span",{className:"font-mono",children:[e.getCommands().length," cmds | ",window.location.href.length," chars"]})})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>{let t=window.location.href;navigator.clipboard.writeText(t).then(()=>{alert(" Shareable link copied!\n\nURL: ".concat(t.length," characters\nCommands: ").concat(e.getCommands().length,"\n\nPaste this link to reload your exact game state."))}).catch(()=>{alert("Share this URL:\n\n".concat(t))})},className:"px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",title:"Copy shareable link with game state",children:[(0,n.jsx)("span",{children:"\uD83D\uDCCB"}),(0,n.jsx)("span",{children:"Share Link"})]}),(0,n.jsx)("button",{onClick:()=>L("current"),className:"px-4 py-2 bg-pink-nebula-accent-primary text-pink-nebula-bg font-semibold rounded-lg hover:bg-pink-nebula-accent-secondary transition-colors",children:"Export Current View"}),(0,n.jsx)("button",{onClick:()=>L("full"),className:"px-4 py-2 bg-pink-nebula-accent-primary text-pink-nebula-bg font-semibold rounded-lg hover:bg-pink-nebula-accent-secondary transition-colors",children:"Export Full List"})]})]}),(0,n.jsx)(Q,{buildingLane:ea,shipLane:ei,colonistLane:eo,researchLane:el,currentTurn:p,onCancel:(e,t)=>eb(e,t),onQuantityChange:(e,t,r)=>e_(e,t,r),getMaxQuantity:(e,t)=>ey(e,t),onReorder:(e,t,r)=>eg(e,t,r),disabled:!1,defs:z,activeTab:M,onTabChange:D})]})]})})]}),null!==E&&(0,n.jsx)(Y,{isOpen:!0,onClose:()=>L(null),buildingLane:ea||{laneId:"building",entries:[]},shipLane:ei||{laneId:"ship",entries:[]},colonistLane:eo||{laneId:"colonist",entries:[]},currentTurn:p,exportMode:E}),(0,n.jsx)(ee,{isOpen:o,onClose:()=>l(!1),onAddPlanet:em,currentTurn:(null==H?void 0:H.currentTurn)||1})]})}}},function(e){e.O(0,[851,971,117,744],function(){return e(e.s=2844)}),_N_E=e.O()}]);